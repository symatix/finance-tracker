import{x as q,j as e,y as ee,g as te,r as h,h as ne,z as V,c as ae,f as J,D as R,b as se,E as oe,G as K,w as I,F,I as P,S as N,M as S,H as M,J as D,P as Y,m as H,K as re,B as E,T as _,L as W,N as ie,l as Q,O as le}from"./index-7Ccxyq_g.js";import{f as ce}from"./formatCurrency-DRYgsAPj.js";import{C as de,A as z}from"./Close-CUb_fB2v.js";import{D as X}from"./Divider-8rNOQW4G.js";import{T as ue,a as me,b as xe,c as G,d as y,e as pe}from"./TableRow-LrOC3fnA.js";import{E as he,D as ge,a as fe,b as ye,c as je,d as be}from"./Edit-CS56Aevz.js";import{P as ve}from"./Pagination-iZ3o2GGA.js";const Te=q(e.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}));function Ce(t){return te("MuiTableSortLabel",t)}const U=ee("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc","directionDesc","directionAsc"]),Se=t=>{const{classes:o,direction:s,active:i}=t,l={root:["root",i&&"active",`direction${R(s)}`],icon:["icon",`iconDirection${R(s)}`]};return se(l,Ce,o)},De=J(oe,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,s.active&&o.active]}})(K(({theme:t})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(t.vars||t).palette.text.secondary},"&:hover":{color:(t.vars||t).palette.text.secondary,[`& .${U.icon}`]:{opacity:.5}},[`&.${U.active}`]:{color:(t.vars||t).palette.text.primary,[`& .${U.icon}`]:{opacity:1,color:(t.vars||t).palette.text.secondary}}}))),we=J("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.icon,o[`iconDirection${R(s.direction)}`]]}})(K(({theme:t})=>({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:t.transitions.create(["opacity","transform"],{duration:t.transitions.duration.shorter}),userSelect:"none",variants:[{props:{direction:"desc"},style:{transform:"rotate(0deg)"}},{props:{direction:"asc"},style:{transform:"rotate(180deg)"}}]}))),B=h.forwardRef(function(o,s){const i=ne({props:o,name:"MuiTableSortLabel"}),{active:l=!1,children:x,className:f,direction:p="asc",hideSortIcon:m=!1,IconComponent:a=Te,slots:n={},slotProps:c={},...d}=i,u={...i,active:l,direction:p,hideSortIcon:m,IconComponent:a},j=Se(u),T={slots:n,slotProps:c},[C,b]=V("root",{elementType:De,externalForwardedProps:T,ownerState:u,className:ae(j.root,f),ref:s}),[v,w]=V("icon",{elementType:we,externalForwardedProps:T,ownerState:u,className:j.icon});return e.jsxs(C,{disableRipple:!0,component:"span",...b,...d,children:[x,m&&!l?null:e.jsx(v,{as:a,...w})]})}),Ie=q(e.jsx("path",{d:"M10.83 8H21V6H8.83zm5 5H18v-2h-4.17zM14 16.83V18h-4v-2h3.17l-3-3H6v-2h2.17l-3-3H3V6h.17L1.39 4.22 2.8 2.81l18.38 18.38-1.41 1.41z"}));function Ae(t,o){const[s,i]=h.useState({category:"",type:"",dateFrom:"",dateTo:"",minAmount:"",maxAmount:"",createdBy:""}),[l,x]=h.useState({field:"date",direction:"desc"}),f=(n,c)=>{i(d=>({...d,[n]:c}))},p=n=>{x(c=>({field:n,direction:c.field===n&&c.direction==="asc"?"desc":"asc"}))},m=()=>{i({category:"",type:"",dateFrom:"",dateTo:"",minAmount:"",maxAmount:"",createdBy:""})},a=h.useMemo(()=>t.filter(n=>s.category?n.categoryId===s.category:!0).filter(n=>s.type?n.type===s.type:!0).filter(n=>s.dateFrom?new Date(n.date)>=new Date(s.dateFrom):!0).filter(n=>s.dateTo?new Date(n.date)<=new Date(s.dateTo):!0).filter(n=>s.minAmount?n.amount>=Number(s.minAmount):!0).filter(n=>s.maxAmount?n.amount<=Number(s.maxAmount):!0).filter(n=>s.createdBy?n.createdBy===s.createdBy:!0).sort((n,c)=>{let d,u;switch(l.field){case"date":d=new Date(n.date).getTime(),u=new Date(c.date).getTime();break;case"amount":d=n.amount,u=c.amount;break;case"type":d=n.type,u=c.type;break;case"category":d=o(n.categoryId),u=o(c.categoryId);break;default:d=0,u=0}return d<u?l.direction==="asc"?-1:1:d>u?l.direction==="asc"?1:-1:0}),[t,s,l,o]);return{filters:s,sort:l,filteredAndSortedTransactions:a,updateFilter:f,updateSort:p,clearFilters:m}}function Me({filters:t,categories:o,familyMembers:s,currentFamilyId:i,onFilterChange:l,onClearFilters:x}){const f=Object.values(t).some(a=>a!==""),[p,m]=h.useState({});return h.useEffect(()=>{(async()=>{if(!s||s.length===0){m({});return}try{const n=s.map(d=>d.user_id),c=await Y.getDisplayNames(n);m(c)}catch(n){console.error("Error loading display names:",n),m({})}})()},[s]),e.jsxs(I,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"flex-end",mb:3,children:[e.jsxs(F,{size:"small",sx:{minWidth:120},children:[e.jsx(P,{children:"Type"}),e.jsxs(N,{value:t.type,onChange:a=>l("type",a.target.value),label:"Type",children:[e.jsx(S,{value:"",children:"All"}),e.jsx(S,{value:"Income",children:"Income"}),e.jsx(S,{value:"Expense",children:"Expense"}),e.jsx(S,{value:"Savings",children:"Savings"})]})]}),e.jsxs(F,{size:"small",sx:{minWidth:150},children:[e.jsx(P,{children:"Category"}),e.jsxs(N,{value:t.category,onChange:a=>l("category",a.target.value),label:"Category",children:[e.jsx(S,{value:"",children:"All"}),o.map(a=>e.jsx(S,{value:a.id,children:a.name},a.id))]})]}),i&&s&&s.length>1&&e.jsxs(F,{size:"small",sx:{minWidth:150},children:[e.jsx(P,{children:"Created By"}),e.jsxs(N,{value:t.createdBy,onChange:a=>l("createdBy",a.target.value),label:"Created By",children:[e.jsx(S,{value:"",children:"All Members"}),s.map(a=>e.jsxs(S,{value:a.user_id,children:[a.role==="owner"?"ðŸ‘‘ ":a.role==="admin"?"âš¡ ":"",p[a.user_id]||"Unknown User"]},a.user_id))]})]}),e.jsx(M,{label:"From",type:"date",size:"small",InputLabelProps:{shrink:!0},value:t.dateFrom,onChange:a=>l("dateFrom",a.target.value)}),e.jsx(M,{label:"To",type:"date",size:"small",InputLabelProps:{shrink:!0},value:t.dateTo,onChange:a=>l("dateTo",a.target.value)}),e.jsx(M,{label:"Min Amount",type:"number",size:"small",value:t.minAmount,onChange:a=>l("minAmount",a.target.value)}),e.jsx(M,{label:"Max Amount",type:"number",size:"small",value:t.maxAmount,onChange:a=>l("maxAmount",a.target.value)}),f&&e.jsx(D,{variant:"outlined",startIcon:e.jsx(Ie,{}),onClick:x,size:"small",children:"Clear"})]})}function ke(t,o,s){const[i,l]=h.useState(1),x=10,[f,p]=h.useState(!1),[m,a]=h.useState(null),[n,c]=h.useState(!1),[d,u]=h.useState(null),j=h.useMemo(()=>{const r=(i-1)*x;return t.slice(r,r+x)},[t,i]),T=Math.ceil(t.length/x);return{page:i,setPage:l,totalPages:T,paginatedTransactions:j,modalOpen:f,selectedTransaction:m,closeModal:()=>{p(!1),a(null)},confirmOpen:n,editTransaction:r=>{a(r),p(!0)},deleteTransaction:r=>{u(r),c(!0)},confirmDelete:()=>{d&&s(d),c(!1),u(null)},cancelDelete:()=>{c(!1),u(null)},saveTransaction:r=>{r.id&&o(r.id,{amount:r.amount,note:r.note,categoryId:r.categoryId,subcategory:r.subcategory}),p(!1),a(null)}}}const Z=({open:t,onClose:o,onSave:s,transaction:i,transactionType:l})=>{const{categories:x,isLoading:f}=H(),p=!!i,m=i?.type||l,[a,n]=h.useState(""),[c,d]=h.useState(""),[u,j]=h.useState(""),[T,C]=h.useState("");h.useEffect(()=>{if(t){if(p&&i)n(i.amount.toString()),d(i.note||""),j(i.categoryId),C(i.subcategory||"");else if(l){const r=x.find(g=>g.type===l);n(""),d(""),j(r?.id||""),C("")}}},[t,i,l,x,p]);const b=x.filter(r=>r.type===m),w=x.find(r=>r.id===u)?.subcategories||[],k=()=>{!a||isNaN(Number(a))||!u||!m||(s({id:i?.id,amount:Number(a),note:c,categoryId:u,subcategory:T||void 0,type:m}),n(""),d(""),j(""),C(""),o())},A=()=>{n(""),d(""),j(""),C(""),o()};return e.jsx(re,{open:t,onClose:A,anchor:"right",PaperProps:{sx:{width:{xs:"100%",sm:400},borderLeft:"1px solid",borderColor:"divider",backgroundColor:"#000000"}},children:e.jsxs(E,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column",backgroundColor:"#1a1a1a"},children:[e.jsxs(E,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(_,{variant:"h6",sx:{fontWeight:600},children:p?"Edit Transaction":`Add ${m}`}),e.jsx(W,{onClick:A,size:"small",children:e.jsx(de,{})})]}),e.jsx(X,{sx:{mb:3}}),e.jsxs(I,{spacing:3,sx:{flexGrow:1,overflow:"visible"},children:[e.jsxs(F,{fullWidth:!0,children:[e.jsx(P,{children:"Category"}),e.jsx(N,{value:u,label:"Category",onChange:r=>j(r.target.value),children:b.map(r=>e.jsx(S,{value:r.id,children:r.name},r.id))})]}),u&&w.length>0&&e.jsxs(F,{fullWidth:!0,children:[e.jsx(P,{children:"Subcategory (Optional)"}),e.jsxs(N,{value:T,label:"Subcategory (Optional)",onChange:r=>C(r.target.value),children:[e.jsx(S,{value:"",children:"None"}),w.map(r=>e.jsx(S,{value:r,children:r},r))]})]}),e.jsx(M,{label:"Amount",type:"number",value:a,onChange:r=>n(r.target.value),fullWidth:!0,required:!0}),e.jsx(M,{label:"Note",value:c,onChange:r=>d(r.target.value),fullWidth:!0,multiline:!0,rows:3})]}),e.jsx(E,{sx:{mt:3,pt:2,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(I,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(D,{onClick:A,disabled:f,children:"Cancel"}),e.jsx(D,{variant:"contained",onClick:k,disabled:!a||!u||f,children:f?p?"Updating...":"Adding...":p?"Update":"Add Transaction"})]})})]})})},Le={Income:"success.main",Expense:"error.main",Savings:"info.main"};function Fe({filteredAndSortedTransactions:t,sort:o,getCategoryName:s,onSort:i,onUpdateTransaction:l,onDeleteTransaction:x,currentFamilyId:f}){const[p,m]=h.useState(new Map),a=h.useCallback(async()=>{try{const g=new Set;if(t.forEach(L=>{L.createdBy&&g.add(L.createdBy)}),g.size===0){m(new Map);return}const O=await Y.getDisplayNames(Array.from(g)),$=new Map;for(const L of g)$.set(L,O[L]||"Unknown User");m($)}catch(g){console.error("Error fetching user profiles:",g),m(new Map)}},[t]);h.useEffect(()=>{f&&a()},[f,a]);const{page:n,setPage:c,totalPages:d,paginatedTransactions:u,modalOpen:j,selectedTransaction:T,confirmOpen:C,editTransaction:b,deleteTransaction:v,confirmDelete:w,cancelDelete:k,saveTransaction:A,closeModal:r}=ke(t,l,x);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{component:ie,children:e.jsxs(me,{children:[e.jsx(xe,{children:e.jsxs(G,{children:[e.jsx(y,{sortDirection:o.field==="date"?o.direction:!1,children:e.jsx(B,{active:o.field==="date",direction:o.field==="date"?o.direction:"asc",onClick:()=>i("date"),children:"Date"})}),e.jsx(y,{sortDirection:o.field==="type"?o.direction:!1,children:e.jsx(B,{active:o.field==="type",direction:o.field==="type"?o.direction:"asc",onClick:()=>i("type"),children:"Type"})}),e.jsx(y,{sortDirection:o.field==="category"?o.direction:!1,children:e.jsx(B,{active:o.field==="category",direction:o.field==="category"?o.direction:"asc",onClick:()=>i("category"),children:"Category"})}),e.jsx(y,{children:"Subcategory"}),e.jsx(y,{sortDirection:o.field==="amount"?o.direction:!1,children:e.jsx(B,{active:o.field==="amount",direction:o.field==="amount"?o.direction:"asc",onClick:()=>i("amount"),children:"Amount"})}),e.jsx(y,{children:"Note"}),f&&e.jsx(y,{children:"Created By"}),e.jsx(y,{align:"right",children:"Actions"})]})}),e.jsx(pe,{children:u.map(g=>e.jsxs(G,{children:[e.jsx(y,{children:new Date(g.date).toLocaleDateString()}),e.jsx(y,{children:g.type}),e.jsx(y,{children:s(g.categoryId)}),e.jsx(y,{children:g.subcategory||"-"}),e.jsx(y,{sx:{color:Le[g.type],fontWeight:"bold"},children:ce(g.amount)}),e.jsx(y,{children:g.note}),f&&e.jsx(y,{children:p.get(g.createdBy||"")||"Unknown User"}),e.jsx(y,{align:"right",children:e.jsxs(I,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(W,{color:"primary",onClick:()=>b(g),children:e.jsx(he,{})}),e.jsx(W,{color:"error",onClick:()=>v(g.id),children:e.jsx(ge,{})})]})})]},g.id))})]})}),e.jsx(I,{mt:2,alignItems:"center",children:e.jsx(ve,{count:d,page:n,onChange:(g,O)=>c(O),color:"primary"})}),j&&T&&e.jsx(Z,{open:j,onClose:r,onSave:A,transaction:T}),e.jsxs(fe,{open:C,onClose:k,children:[e.jsx(ye,{children:"Confirm Delete"}),e.jsx(je,{children:e.jsx(_,{children:"Are you sure you want to delete this transaction?"})}),e.jsxs(be,{children:[e.jsx(D,{onClick:k,children:"Cancel"}),e.jsx(D,{color:"error",variant:"contained",onClick:w,children:"Delete"})]})]})]})}function Pe(){const{user:t}=Q(),{addTransaction:o,isLoading:s}=H(),[i,l]=h.useState(!1),[x,f]=h.useState("Income"),p=n=>{f(n),l(!0)},m=()=>l(!1),a=async n=>{if(t)try{await o(t.id,{type:n.type,amount:n.amount,categoryId:n.categoryId,subcategory:n.subcategory,note:n.note,date:new Date().toISOString()}),m()}catch(c){console.error("Failed to add transaction:",c)}};return e.jsxs(e.Fragment,{children:[e.jsxs(I,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"flex-end",children:[e.jsx(D,{variant:"contained",startIcon:e.jsx(z,{}),color:"info",onClick:()=>p("Income"),disabled:s,children:"Add Income"}),e.jsx(D,{variant:"contained",startIcon:e.jsx(z,{}),color:"info",onClick:()=>p("Expense"),disabled:s,children:"Add Expense"}),e.jsx(D,{variant:"contained",startIcon:e.jsx(z,{}),color:"info",onClick:()=>p("Savings"),disabled:s,children:"Add Savings"})]}),e.jsx(Z,{open:i,onClose:m,onSave:a,transactionType:x})]})}function We(){const{user:t}=Q(),{transactions:o,categories:s,updateTransaction:i,deleteTransaction:l,currentFamilyId:x}=H(),[f,p]=h.useState([]);h.useEffect(()=>{(async()=>{if(x)try{const v=await le.findByFamilyId(x);p(v)}catch(v){console.error("Error loading family members:",v),p([])}})()},[x]);const m=b=>s.find(v=>v.id===b)?.name||"Uncategorized",{filters:a,sort:n,filteredAndSortedTransactions:c,updateFilter:d,updateSort:u,clearFilters:j}=Ae(o,m),T=(b,v)=>{t&&i(t.id,b,v)},C=b=>{t&&l(t.id,b)};return e.jsxs(E,{p:4,children:[e.jsxs(I,{direction:{xs:"column",sm:"row"},justifyContent:{xs:"flex-start",sm:"space-between"},alignItems:"baseline",mb:1,children:[e.jsx(_,{variant:"h5",children:"Transaction Details"}),e.jsx(Pe,{})]}),e.jsx(X,{sx:{mb:3}}),e.jsx(Me,{filters:a,categories:s,onFilterChange:d,onClearFilters:j,familyMembers:f,currentFamilyId:x}),e.jsx(Fe,{filteredAndSortedTransactions:c,sort:n,getCategoryName:m,onSort:u,onUpdateTransaction:T,onDeleteTransaction:C,currentFamilyId:x})]})}export{We as default};
