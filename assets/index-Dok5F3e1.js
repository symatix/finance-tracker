import{g as $,w as J,r as x,h as K,j as e,f as Q,c as X,b as Z,T as E,C as ee,v as te,l as U,m as z,G as ne,B as I,H as O,t as T,D,F as _,I as A,S as M,M as v,E as S,P as se,A as ae}from"./index-pDMVrzzH.js";import{C as re,E as le,D as oe,a as ie,b as ce,c as de,d as ue,A as xe}from"./Edit-DHcjPJjN.js";import{f as he}from"./formatCurrency-DRYgsAPj.js";import{T as me,a as pe,b as ge,c as B,d as u,e as fe}from"./TableRow-SUwbmtEy.js";import{C as L}from"./Chip-PuIzE2sX.js";import{P as je}from"./Pagination-BDqg-PgM.js";import{u as ye}from"./useBudgetAlerts-CkrbUAth.js";import{D as ve}from"./Divider-CyUvQA4o.js";function Ce(s){return $("MuiAlertTitle",s)}J("MuiAlertTitle",["root"]);const be=s=>{const{classes:i}=s;return Z({root:["root"]},Ce,i)},Ee=Q(E,{name:"MuiAlertTitle",slot:"Root"})(ee(({theme:s})=>({fontWeight:s.typography.fontWeightMedium,marginTop:-2}))),Te=x.forwardRef(function(i,h){const r=K({props:i,name:"MuiAlertTitle"}),{className:d,...a}=r,p=r,l=be(p);return e.jsx(Ee,{gutterBottom:!0,component:"div",ownerState:p,ref:h,className:X(l.root,d),...a})}),we=te(e.jsx("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}));function Pe(){const{user:s}=U(),{plannedExpenses:i,addPlannedExpense:h,updatePlannedExpense:r,deletePlannedExpense:d,loadPlannedExpenses:a,convertPlannedExpenseToTransaction:p}=z(),[l,o]=x.useState(!1);return x.useEffect(()=>{s&&i.length===0&&a(s.id)},[s,a,i.length]),{plannedExpenses:i,loading:l,createPlannedExpense:async t=>{if(s){o(!0);try{await h(s.id,{...t,user_id:s.id})}finally{o(!1)}}},updatePlannedExpense:async(t,c)=>{if(s){o(!0);try{await r(s.id,t,c)}finally{o(!1)}}},deletePlannedExpense:async t=>{if(s){o(!0);try{await d(s.id,t)}finally{o(!1)}}},convertToTransaction:async t=>{if(s){o(!0);try{await p(s.id,t)}finally{o(!1)}}}}}function R({open:s,onClose:i,onSubmit:h,editingExpense:r}){const{categories:d}=z(),[a,p]=x.useState({name:"",amount:0,category_id:"",subcategory:"",note:"",due_date:new Date().toISOString().split("T")[0],priority:"medium",status:"planned"}),[l,o]=x.useState({});x.useEffect(()=>{p(r?{name:r.name,amount:r.amount,category_id:r.category_id,subcategory:r.subcategory||"",note:r.note||"",due_date:r.due_date,priority:r.priority,status:r.status}:{name:"",amount:0,category_id:"",subcategory:"",note:"",due_date:new Date().toISOString().split("T")[0],priority:"medium",status:"planned"}),o({})},[r,s]);const j=d.find(t=>t.id===a.category_id)?.subcategories||[],y=t=>{t.preventDefault();const c={};if(a.name.trim()||(c.name="Name is required"),a.amount<=0&&(c.amount="Amount must be greater than 0"),a.category_id||(c.category_id="Category is required"),a.due_date||(c.due_date="Due date is required"),Object.keys(c).length>0){o(c);return}h({...a,subcategory:a.subcategory||null,note:a.note||""})},m=(t,c)=>{p(g=>({...g,[t]:c})),l[t]&&o(g=>({...g,[t]:""}))};return e.jsx(ne,{anchor:"right",open:s,onClose:i,PaperProps:{sx:{width:{xs:"100%",sm:400}}},children:e.jsxs(I,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(E,{variant:"h6",children:r?"Edit Planned Expense":"New Planned Expense"}),e.jsx(O,{onClick:i,size:"small",children:e.jsx(re,{})})]}),e.jsxs(I,{component:"form",onSubmit:y,sx:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs(T,{spacing:3,sx:{flex:1},children:[e.jsx(D,{label:"Name",value:a.name,onChange:t=>m("name",t.target.value),error:!!l.name,helperText:l.name,required:!0,fullWidth:!0}),e.jsx(D,{label:"Amount",type:"number",value:a.amount,onChange:t=>m("amount",parseFloat(t.target.value)||0),error:!!l.amount,helperText:l.amount,required:!0,fullWidth:!0,inputProps:{min:0,step:.01}}),e.jsxs(_,{fullWidth:!0,error:!!l.category_id,children:[e.jsx(A,{children:"Category"}),e.jsx(M,{value:a.category_id,onChange:t=>m("category_id",t.target.value),label:"Category",required:!0,children:d.map(t=>e.jsxs(v,{value:t.id,children:[t.name," (",t.type,")"]},t.id))}),l.category_id&&e.jsx(E,{variant:"caption",color:"error",sx:{mt:1,ml:2},children:l.category_id})]}),j.length>0&&e.jsxs(_,{fullWidth:!0,children:[e.jsx(A,{children:"Subcategory (Optional)"}),e.jsxs(M,{value:a.subcategory,onChange:t=>m("subcategory",t.target.value),label:"Subcategory (Optional)",children:[e.jsx(v,{value:"",children:e.jsx("em",{children:"None"})}),j.map(t=>e.jsx(v,{value:t,children:t},t))]})]}),e.jsx(D,{label:"Due Date",type:"date",value:a.due_date,onChange:t=>m("due_date",t.target.value),error:!!l.due_date,helperText:l.due_date,required:!0,fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsxs(_,{fullWidth:!0,children:[e.jsx(A,{children:"Priority"}),e.jsxs(M,{value:a.priority,onChange:t=>m("priority",t.target.value),label:"Priority",children:[e.jsx(v,{value:"low",children:"Low"}),e.jsx(v,{value:"medium",children:"Medium"}),e.jsx(v,{value:"high",children:"High"}),e.jsx(v,{value:"urgent",children:"Urgent"})]})]}),r&&e.jsxs(_,{fullWidth:!0,children:[e.jsx(A,{children:"Status"}),e.jsxs(M,{value:a.status,onChange:t=>m("status",t.target.value),label:"Status",children:[e.jsx(v,{value:"planned",children:"Planned"}),e.jsx(v,{value:"confirmed",children:"Confirmed"}),e.jsx(v,{value:"completed",children:"Completed"}),e.jsx(v,{value:"cancelled",children:"Cancelled"})]})]}),e.jsx(D,{label:"Note (Optional)",value:a.note,onChange:t=>m("note",t.target.value),multiline:!0,rows:3,fullWidth:!0})]}),e.jsxs(T,{direction:"row",spacing:2,sx:{mt:4},children:[e.jsx(S,{variant:"outlined",onClick:i,fullWidth:!0,children:"Cancel"}),e.jsx(S,{variant:"contained",type:"submit",fullWidth:!0,children:r?"Update":"Create"})]})]})]})})}const W=10;function Se(s,i,h,r){const[d,a]=x.useState(1),[p,l]=x.useState(!1),[o,C]=x.useState(void 0),[j,y]=x.useState(!1),[m,t]=x.useState(""),c=x.useMemo(()=>[...s].sort((f,k)=>{const V=new Date(f.due_date).getTime(),Y=new Date(k.due_date).getTime();return V-Y}),[s]),g=Math.ceil(c.length/W),w=x.useMemo(()=>{const f=(d-1)*W,k=f+W;return c.slice(f,k)},[c,d]);x.useMemo(()=>{d>g&&g>0&&a(1)},[d,g]);const P=f=>{C(f),l(!0)},n=f=>{t(f),y(!0)},b=f=>{r(f)},q=()=>{h(m),y(!1),t("")},F=()=>{y(!1),t("")},G=async f=>{o&&await i(o.id,f),H()},H=()=>{l(!1),C(void 0)};return{page:d,setPage:a,totalPages:g,paginatedExpenses:w,modalOpen:p,selectedExpense:o,confirmOpen:j,editExpense:P,deleteExpense:n,convertExpense:b,confirmDelete:q,cancelDelete:F,saveExpense:G,closeModal:H}}const De={low:"Low",medium:"Medium",high:"High",urgent:"Urgent"},_e={planned:"Planned",confirmed:"Confirmed",completed:"Completed",cancelled:"Cancelled"},Ae=s=>{switch(s){case"low":return"success";case"medium":return"info";case"high":return"warning";case"urgent":return"error";default:return"default"}},Me=s=>{switch(s){case"planned":return"default";case"confirmed":return"info";case"completed":return"success";case"cancelled":return"error";default:return"default"}},N=s=>{const i=new Date().toISOString().split("T")[0],h=new Date(s),r=new Date(i);return h<r?"error":h.toISOString().split("T")[0]===i?"warning":"default"};function Ie({plannedExpenses:s,onUpdateExpense:i,onDeleteExpense:h,onConvertToTransaction:r}){const{page:d,setPage:a,totalPages:p,paginatedExpenses:l,modalOpen:o,selectedExpense:C,confirmOpen:j,editExpense:y,deleteExpense:m,convertExpense:t,confirmDelete:c,cancelDelete:g,saveExpense:w,closeModal:P}=Se(s,i,h,r);return e.jsxs(e.Fragment,{children:[e.jsx(me,{component:se,children:e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsxs(B,{children:[e.jsx(u,{children:"Name"}),e.jsx(u,{children:"Amount"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Due Date"}),e.jsx(u,{children:"Priority"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Note"}),e.jsx(u,{align:"right",children:"Actions"})]})}),e.jsx(fe,{children:l.map(n=>e.jsxs(B,{sx:{opacity:n.status==="completed"?.7:1},children:[e.jsx(u,{children:n.name}),e.jsx(u,{sx:{fontWeight:"bold"},children:he(n.amount)}),e.jsxs(u,{children:[n.categoryName," ",n.subcategory&&` / ${n.subcategory}`]}),e.jsx(u,{children:e.jsx(E,{variant:"body2",color:N(n.due_date),fontWeight:N(n.due_date)!=="default"?"bold":"normal",children:new Date(n.due_date).toLocaleDateString()})}),e.jsx(u,{children:e.jsx(L,{label:De[n.priority],color:Ae(n.priority),size:"small",variant:"outlined"})}),e.jsx(u,{children:e.jsx(L,{label:_e[n.status],color:Me(n.status),size:"small"})}),e.jsx(u,{children:n.note||"-"}),e.jsx(u,{align:"right",children:e.jsxs(T,{direction:"row",spacing:1,justifyContent:"flex-end",children:[n.status!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{color:"primary",onClick:()=>y(n),size:"small",children:e.jsx(le,{})}),e.jsx(O,{color:"secondary",onClick:()=>t(n.id),size:"small",children:e.jsx(we,{})})]}),e.jsx(O,{color:"error",onClick:()=>m(n.id),size:"small",children:e.jsx(oe,{})})]})})]},n.id))})]})}),e.jsx(T,{mt:2,alignItems:"center",children:e.jsx(je,{count:p,page:d,onChange:(n,b)=>a(b),color:"primary"})}),o&&C&&e.jsx(R,{open:o,onClose:P,onSubmit:w,editingExpense:C}),e.jsxs(ie,{open:j,onClose:g,children:[e.jsx(ce,{children:"Confirm Delete"}),e.jsx(de,{children:e.jsx(E,{children:"Are you sure you want to delete this planned expense?"})}),e.jsxs(ue,{children:[e.jsx(S,{onClick:g,children:"Cancel"}),e.jsx(S,{color:"error",variant:"contained",onClick:c,children:"Delete"})]})]})]})}function ze(){const{user:s}=U(),{plannedExpenses:i,loading:h,createPlannedExpense:r,updatePlannedExpense:d,deletePlannedExpense:a,convertToTransaction:p}=Pe(),{alerts:l}=ye(),[o,C]=x.useState(!1),[j,y]=x.useState(void 0),m=()=>{y(void 0),C(!0)},t=()=>{C(!1),y(void 0)},c=async n=>{j?await d(j.id,n):await r(n),t()},g=async(n,b)=>{await d(n,b)},w=async n=>{confirm("Are you sure you want to delete this planned expense?")&&await a(n)},P=async n=>{confirm("Convert this planned expense to a transaction?")&&await p(n)};return s?e.jsxs(I,{p:4,children:[e.jsxs(T,{direction:{xs:"column",sm:"row"},justifyContent:{xs:"flex-start",sm:"space-between"},alignItems:{xs:"flex-start",sm:"center"},mb:1,spacing:2,children:[e.jsx(E,{variant:"h5",children:"Planned Expenses"}),e.jsx(S,{variant:"contained",startIcon:e.jsx(xe,{}),onClick:m,sx:{width:{xs:"100%",sm:"auto"}},children:"New Planned Expense"})]}),e.jsx(ve,{sx:{mb:3}}),l.length>0&&e.jsx(T,{spacing:2,sx:{mb:3},children:l.map((n,b)=>e.jsxs(ae,{severity:n.type==="danger"?"error":n.type,sx:{"& .MuiAlert-message":{width:"100%"}},children:[e.jsx(Te,{children:n.type==="danger"?"⚠️ Critical":n.type==="warning"?"⚡ Warning":"ℹ️ Info"}),n.message]},b))}),h?e.jsx(E,{children:"Loading..."}):e.jsx(Ie,{plannedExpenses:i,onUpdateExpense:g,onDeleteExpense:w,onConvertToTransaction:P}),e.jsx(R,{open:o,onClose:t,onSubmit:c,editingExpense:j})]}):null}export{ze as default};
