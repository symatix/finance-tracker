import{r as u,ac as ve,ad as xe,ae as B,af as A,ag as ye,ah as U,g as X,y as K,h as J,j as n,f as R,c as Ce,b as Y,N as q,G as Q,ai as N,k as be,z as L,aj as ke,D as T,x as _e,ak as je,l as we,B as x,T as S,J as M,H as y,A as Se,P as $}from"./index-DpbbXsWZ.js";import{A as Ee}from"./Avatar-BQgDGFls.js";import{D as Pe}from"./Divider-BZDYSeNq.js";import{S as Le}from"./Save-CQ5iPj4O.js";function G(a){return a.substring(2).toLowerCase()}function Te(a,r){return r.documentElement.clientWidth<a.clientX||r.documentElement.clientHeight<a.clientY}function Re(a){const{children:r,disableReactTree:t=!1,mouseEvent:l="onClick",onClickAway:f,touchEvent:h="onTouchEnd"}=a,g=u.useRef(!1),p=u.useRef(null),m=u.useRef(!1),d=u.useRef(!1);u.useEffect(()=>(setTimeout(()=>{m.current=!0},0),()=>{m.current=!1}),[]);const v=ve(xe(r),p),o=B(e=>{const s=d.current;d.current=!1;const C=A(p.current);if(!m.current||!p.current||"clientX"in e&&Te(e,C))return;if(g.current){g.current=!1;return}let i;e.composedPath?i=e.composedPath().includes(p.current):i=!C.documentElement.contains(e.target)||p.current.contains(e.target),!i&&(t||!s)&&f(e)}),_=e=>s=>{d.current=!0;const C=r.props[e];C&&C(s)},k={ref:v};return h!==!1&&(k[h]=_(h)),u.useEffect(()=>{if(h!==!1){const e=G(h),s=A(p.current),C=()=>{g.current=!0};return s.addEventListener(e,o),s.addEventListener("touchmove",C),()=>{s.removeEventListener(e,o),s.removeEventListener("touchmove",C)}}},[o,h]),l!==!1&&(k[l]=_(l)),u.useEffect(()=>{if(l!==!1){const e=G(l),s=A(p.current);return s.addEventListener(e,o),()=>{s.removeEventListener(e,o)}}},[o,l]),u.cloneElement(r,k)}function Ae(a={}){const{autoHideDuration:r=null,disableWindowBlurListener:t=!1,onClose:l,open:f,resumeHideDuration:h}=a,g=ye();u.useEffect(()=>{if(!f)return;function i(c){c.defaultPrevented||c.key==="Escape"&&l?.(c,"escapeKeyDown")}return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[f,l]);const p=B((i,c)=>{l?.(i,c)}),m=B(i=>{!l||i==null||g.start(i,()=>{p(null,"timeout")})});u.useEffect(()=>(f&&m(r),g.clear),[f,r,m,g]);const d=i=>{l?.(i,"clickaway")},v=g.clear,o=u.useCallback(()=>{r!=null&&m(h??r*.5)},[r,h,m]),_=i=>c=>{const j=i.onBlur;j?.(c),o()},k=i=>c=>{const j=i.onFocus;j?.(c),v()},e=i=>c=>{const j=i.onMouseEnter;j?.(c),v()},s=i=>c=>{const j=i.onMouseLeave;j?.(c),o()};return u.useEffect(()=>{if(!t&&f)return window.addEventListener("focus",o),window.addEventListener("blur",v),()=>{window.removeEventListener("focus",o),window.removeEventListener("blur",v)}},[t,f,o,v]),{getRootProps:(i={})=>{const c={...U(a),...U(i)};return{role:"presentation",...i,...c,onBlur:_(c),onFocus:k(c),onMouseEnter:e(c),onMouseLeave:s(c)}},onClickAway:d}}function Me(a){return X("MuiSnackbarContent",a)}K("MuiSnackbarContent",["root","message","action"]);const Be=a=>{const{classes:r}=a;return Y({root:["root"],action:["action"],message:["message"]},Me,r)},Oe=R(q,{name:"MuiSnackbarContent",slot:"Root"})(Q(({theme:a})=>{const r=a.palette.mode==="light"?.8:.98;return{...a.typography.body2,color:a.vars?a.vars.palette.SnackbarContent.color:a.palette.getContrastText(N(a.palette.background.default,r)),backgroundColor:a.vars?a.vars.palette.SnackbarContent.bg:N(a.palette.background.default,r),display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",flexGrow:1,[a.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}}})),We=R("div",{name:"MuiSnackbarContent",slot:"Message"})({padding:"8px 0"}),De=R("div",{name:"MuiSnackbarContent",slot:"Action"})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),He=u.forwardRef(function(r,t){const l=J({props:r,name:"MuiSnackbarContent"}),{action:f,className:h,message:g,role:p="alert",...m}=l,d=l,v=Be(d);return n.jsxs(Oe,{role:p,elevation:6,className:Ce(v.root,h),ownerState:d,ref:t,...m,children:[n.jsx(We,{className:v.message,ownerState:d,children:g}),f?n.jsx(De,{className:v.action,ownerState:d,children:f}):null]})});function Ie(a){return X("MuiSnackbar",a)}K("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const ze=a=>{const{classes:r,anchorOrigin:t}=a,l={root:["root",`anchorOrigin${T(t.vertical)}${T(t.horizontal)}`]};return Y(l,Ie,r)},Fe=R("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:t}=a;return[r.root,r[`anchorOrigin${T(t.anchorOrigin.vertical)}${T(t.anchorOrigin.horizontal)}`]]}})(Q(({theme:a})=>({zIndex:(a.vars||a).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center",variants:[{props:({ownerState:r})=>r.anchorOrigin.vertical==="top",style:{top:8,[a.breakpoints.up("sm")]:{top:24}}},{props:({ownerState:r})=>r.anchorOrigin.vertical!=="top",style:{bottom:8,[a.breakpoints.up("sm")]:{bottom:24}}},{props:({ownerState:r})=>r.anchorOrigin.horizontal==="left",style:{justifyContent:"flex-start",[a.breakpoints.up("sm")]:{left:24,right:"auto"}}},{props:({ownerState:r})=>r.anchorOrigin.horizontal==="right",style:{justifyContent:"flex-end",[a.breakpoints.up("sm")]:{right:24,left:"auto"}}},{props:({ownerState:r})=>r.anchorOrigin.horizontal==="center",style:{[a.breakpoints.up("sm")]:{left:"50%",right:"auto",transform:"translateX(-50%)"}}}]}))),Ue=u.forwardRef(function(r,t){const l=J({props:r,name:"MuiSnackbar"}),f=be(),h={enter:f.transitions.duration.enteringScreen,exit:f.transitions.duration.leavingScreen},{action:g,anchorOrigin:{vertical:p,horizontal:m}={vertical:"bottom",horizontal:"left"},autoHideDuration:d=null,children:v,className:o,ClickAwayListenerProps:_,ContentProps:k,disableWindowBlurListener:e=!1,message:s,onBlur:C,onClose:i,onFocus:c,onMouseEnter:j,onMouseLeave:$e,open:O,resumeHideDuration:Ge,slots:W={},slotProps:V={},TransitionComponent:D,transitionDuration:H=h,TransitionProps:{onEnter:I,onExited:z,...Z}={},...ee}=l,E={...l,anchorOrigin:{vertical:p,horizontal:m},autoHideDuration:d,disableWindowBlurListener:e,TransitionComponent:D,transitionDuration:H},te=ze(E),{getRootProps:ne,onClickAway:re}=Ae({...E}),[ae,F]=u.useState(!0),oe=w=>{F(!0),z&&z(w)},se=(w,b)=>{F(!1),I&&I(w,b)},P={slots:{transition:D,...W},slotProps:{content:k,clickAwayListener:_,transition:Z,...V}},[ie,le]=L("root",{ref:t,className:[te.root,o],elementType:Fe,getSlotProps:ne,externalForwardedProps:{...P,...ee},ownerState:E}),[ce,{ownerState:ue,...de}]=L("clickAwayListener",{elementType:Re,externalForwardedProps:P,getSlotProps:w=>({onClickAway:(...b)=>{const ge=b[0];w.onClickAway?.(...b),!ge?.defaultMuiPrevented&&re(...b)}}),ownerState:E}),[pe,fe]=L("content",{elementType:He,shouldForwardComponentProp:!0,externalForwardedProps:P,additionalProps:{message:s,action:g},ownerState:E}),[he,me]=L("transition",{elementType:ke,externalForwardedProps:P,getSlotProps:w=>({onEnter:(...b)=>{w.onEnter?.(...b),se(...b)},onExited:(...b)=>{w.onExited?.(...b),oe(...b)}}),additionalProps:{appear:!0,in:O,timeout:H,direction:p==="top"?"down":"up"},ownerState:E});return!O&&ae?null:n.jsx(ce,{...de,...W.clickAwayListener&&{ownerState:ue},children:n.jsx(ie,{...le,children:n.jsx(he,{...me,children:v||n.jsx(pe,{...fe})})})})}),Ne=_e(n.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}));function qe(){const a=je(),{user:r}=we(),[t,l]=u.useState({}),[f,h]=u.useState(!0),[g,p]=u.useState(!1),[m,d]=u.useState({open:!1,message:"",severity:"success"});u.useEffect(()=>{(async()=>{if(r)try{const s=await $.findByUserId(r.id);s&&l(s)}catch(s){console.error("Error loading profile:",s),d({open:!0,message:"Failed to load profile",severity:"error"})}finally{h(!1)}})()},[r]);const v=async()=>{if(r){p(!0);try{await $.upsert(r.id,{email:r.email,first_name:t.first_name||null,last_name:t.last_name||null,display_name:t.display_name||null,address_line_1:t.address_line_1||null,address_line_2:t.address_line_2||null,city:t.city||null,state_province:t.state_province||null,postal_code:t.postal_code||null,country:t.country||null,phone:t.phone||null,date_of_birth:t.date_of_birth||null,avatar_url:t.avatar_url||null,bio:t.bio||null}),d({open:!0,message:"Profile saved successfully",severity:"success"})}catch(e){console.error("Error saving profile:",e),d({open:!0,message:"Failed to save profile",severity:"error"})}finally{p(!1)}}},o=(e,s)=>{l(C=>({...C,[e]:s||void 0}))},_=()=>t.display_name?t.display_name:t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.first_name?t.first_name:t.last_name?t.last_name:r?.email?.split("@")[0]||"User",k=()=>{const e=t.first_name?.[0]||"",s=t.last_name?.[0]||"";return e||s?(e+s).toUpperCase():r?.email?.[0]?.toUpperCase()||"U"};return f?n.jsx(x,{p:4,display:"flex",justifyContent:"center",children:n.jsx(S,{children:"Loading profile..."})}):n.jsxs(x,{p:4,maxWidth:"800px",mx:"auto",children:[n.jsxs(x,{mb:4,display:"flex",alignItems:"center",gap:2,children:[n.jsx(M,{startIcon:n.jsx(Ne,{}),onClick:()=>a(-1),variant:"outlined",children:"Back"}),n.jsx(S,{variant:"h4",component:"h1",children:"Edit Profile"})]}),n.jsxs(q,{elevation:2,sx:{p:3,mb:3},children:[n.jsxs(x,{display:"flex",alignItems:"center",gap:3,mb:3,children:[n.jsx(Ee,{sx:{width:80,height:80,bgcolor:"primary.main",fontSize:"2rem"},src:t.avatar_url||void 0,children:!t.avatar_url&&k()}),n.jsxs(x,{children:[n.jsx(S,{variant:"h5",children:_()}),n.jsx(S,{variant:"body2",color:"text.secondary",children:r?.email})]})]}),n.jsx(Pe,{sx:{mb:3}}),n.jsx(S,{variant:"h6",gutterBottom:!0,children:"Basic Information"}),n.jsxs(x,{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:3,mb:4,children:[n.jsx(y,{fullWidth:!0,label:"First Name",value:t.first_name||"",onChange:e=>o("first_name",e.target.value)}),n.jsx(y,{fullWidth:!0,label:"Last Name",value:t.last_name||"",onChange:e=>o("last_name",e.target.value)}),n.jsx(x,{gridColumn:"1 / -1",children:n.jsx(y,{fullWidth:!0,label:"Display Name",value:t.display_name||"",onChange:e=>o("display_name",e.target.value),helperText:"This name will be displayed in family accounts"})}),n.jsx(x,{gridColumn:"1 / -1",children:n.jsx(y,{fullWidth:!0,label:"Phone",value:t.phone||"",onChange:e=>o("phone",e.target.value)})}),n.jsx(x,{gridColumn:"1 / -1",children:n.jsx(y,{fullWidth:!0,label:"Date of Birth",type:"date",value:t.date_of_birth||"",onChange:e=>o("date_of_birth",e.target.value),InputLabelProps:{shrink:!0}})})]}),n.jsx(S,{variant:"h6",gutterBottom:!0,children:"Address"}),n.jsxs(x,{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:3,mb:4,children:[n.jsx(x,{gridColumn:"1 / -1",children:n.jsx(y,{fullWidth:!0,label:"Address Line 1",value:t.address_line_1||"",onChange:e=>o("address_line_1",e.target.value)})}),n.jsx(x,{gridColumn:"1 / -1",children:n.jsx(y,{fullWidth:!0,label:"Address Line 2",value:t.address_line_2||"",onChange:e=>o("address_line_2",e.target.value)})}),n.jsx(y,{fullWidth:!0,label:"City",value:t.city||"",onChange:e=>o("city",e.target.value)}),n.jsx(y,{fullWidth:!0,label:"State/Province",value:t.state_province||"",onChange:e=>o("state_province",e.target.value)}),n.jsx(y,{fullWidth:!0,label:"Postal Code",value:t.postal_code||"",onChange:e=>o("postal_code",e.target.value)}),n.jsx(y,{fullWidth:!0,label:"Country",value:t.country||"",onChange:e=>o("country",e.target.value)})]}),n.jsx(S,{variant:"h6",gutterBottom:!0,children:"Additional Information"}),n.jsxs(x,{display:"grid",gap:3,mb:4,children:[n.jsx(y,{fullWidth:!0,label:"Avatar URL",value:t.avatar_url||"",onChange:e=>o("avatar_url",e.target.value),helperText:"URL to your profile picture"}),n.jsx(y,{fullWidth:!0,multiline:!0,rows:3,label:"Bio",value:t.bio||"",onChange:e=>o("bio",e.target.value),helperText:"Tell others about yourself"})]}),n.jsxs(x,{display:"flex",justifyContent:"flex-end",gap:2,children:[n.jsx(M,{variant:"outlined",onClick:()=>a(-1),children:"Cancel"}),n.jsx(M,{variant:"contained",startIcon:n.jsx(Le,{}),onClick:v,disabled:g,children:g?"Saving...":"Save Profile"})]})]}),n.jsx(Ue,{open:m.open,autoHideDuration:6e3,onClose:()=>d(e=>({...e,open:!1})),children:n.jsx(Se,{onClose:()=>d(e=>({...e,open:!1})),severity:m.severity,sx:{width:"100%"},children:m.message})})]})}export{qe as default};
