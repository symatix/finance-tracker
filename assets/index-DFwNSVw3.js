import{v as $,j as e,w as K,g as Q,r as f,h as X,x as W,c as Z,f as V,y as N,b as ee,z as te,C as _,t as S,F,I as P,S as z,M as T,D as I,E as C,m as U,G as ne,B as L,T as B,H as R,P as ae,l as G}from"./index-pDMVrzzH.js";import{f as oe}from"./formatCurrency-DRYgsAPj.js";import{C as se,E as re,D as ie,a as le,b as ce,c as de,d as ue,A as O}from"./Edit-DHcjPJjN.js";import{D as q}from"./Divider-CyUvQA4o.js";import{T as xe,a as me,b as pe,c as H,d as y,e as he}from"./TableRow-SUwbmtEy.js";import{P as ge}from"./Pagination-BDqg-PgM.js";const fe=$(e.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}));function je(t){return Q("MuiTableSortLabel",t)}const E=K("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc","directionDesc","directionAsc"]),ye=t=>{const{classes:n,direction:o,active:i}=t,l={root:["root",i&&"active",`direction${N(o)}`],icon:["icon",`iconDirection${N(o)}`]};return ee(l,je,n)},be=V(te,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[n.root,o.active&&n.active]}})(_(({theme:t})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(t.vars||t).palette.text.secondary},"&:hover":{color:(t.vars||t).palette.text.secondary,[`& .${E.icon}`]:{opacity:.5}},[`&.${E.active}`]:{color:(t.vars||t).palette.text.primary,[`& .${E.icon}`]:{opacity:1,color:(t.vars||t).palette.text.secondary}}}))),ve=V("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[n.icon,n[`iconDirection${N(o.direction)}`]]}})(_(({theme:t})=>({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:t.transitions.create(["opacity","transform"],{duration:t.transitions.duration.shorter}),userSelect:"none",variants:[{props:{direction:"desc"},style:{transform:"rotate(0deg)"}},{props:{direction:"asc"},style:{transform:"rotate(180deg)"}}]}))),k=f.forwardRef(function(n,o){const i=X({props:n,name:"MuiTableSortLabel"}),{active:l=!1,children:s,className:j,direction:x="asc",hideSortIcon:p=!1,IconComponent:m=fe,slots:a={},slotProps:d={},...u}=i,c={...i,active:l,direction:x,hideSortIcon:p,IconComponent:m},h=ye(c),b={slots:a,slotProps:d},[v,D]=W("root",{elementType:be,externalForwardedProps:b,ownerState:c,className:Z(h.root,j),ref:o}),[A,g]=W("icon",{elementType:ve,externalForwardedProps:b,ownerState:c,className:h.icon});return e.jsxs(v,{disableRipple:!0,component:"span",...D,...u,children:[s,p&&!l?null:e.jsx(A,{as:m,...g})]})}),Te=$(e.jsx("path",{d:"M10.83 8H21V6H8.83zm5 5H18v-2h-4.17zM14 16.83V18h-4v-2h3.17l-3-3H6v-2h2.17l-3-3H3V6h.17L1.39 4.22 2.8 2.81l18.38 18.38-1.41 1.41z"}));function Ce(t,n){const[o,i]=f.useState({category:"",type:"",dateFrom:"",dateTo:"",minAmount:"",maxAmount:""}),[l,s]=f.useState({field:"date",direction:"desc"}),j=(a,d)=>{i(u=>({...u,[a]:d}))},x=a=>{s(d=>({field:a,direction:d.field===a&&d.direction==="asc"?"desc":"asc"}))},p=()=>{i({category:"",type:"",dateFrom:"",dateTo:"",minAmount:"",maxAmount:""})},m=f.useMemo(()=>t.filter(a=>o.category?a.categoryId===o.category:!0).filter(a=>o.type?a.type===o.type:!0).filter(a=>o.dateFrom?new Date(a.date)>=new Date(o.dateFrom):!0).filter(a=>o.dateTo?new Date(a.date)<=new Date(o.dateTo):!0).filter(a=>o.minAmount?a.amount>=Number(o.minAmount):!0).filter(a=>o.maxAmount?a.amount<=Number(o.maxAmount):!0).sort((a,d)=>{let u,c;switch(l.field){case"date":u=new Date(a.date).getTime(),c=new Date(d.date).getTime();break;case"amount":u=a.amount,c=d.amount;break;case"type":u=a.type,c=d.type;break;case"category":u=n(a.categoryId),c=n(d.categoryId);break;default:u=0,c=0}return u<c?l.direction==="asc"?-1:1:u>c?l.direction==="asc"?1:-1:0}),[t,o,l,n]);return{filters:o,sort:l,filteredAndSortedTransactions:m,updateFilter:j,updateSort:x,clearFilters:p}}function Se({filters:t,categories:n,onFilterChange:o,onClearFilters:i}){const l=Object.values(t).some(s=>s!=="");return e.jsxs(S,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"flex-end",mb:3,children:[e.jsxs(F,{size:"small",sx:{minWidth:120},children:[e.jsx(P,{children:"Type"}),e.jsxs(z,{value:t.type,onChange:s=>o("type",s.target.value),label:"Type",children:[e.jsx(T,{value:"",children:"All"}),e.jsx(T,{value:"Income",children:"Income"}),e.jsx(T,{value:"Expense",children:"Expense"}),e.jsx(T,{value:"Savings",children:"Savings"})]})]}),e.jsxs(F,{size:"small",sx:{minWidth:150},children:[e.jsx(P,{children:"Category"}),e.jsxs(z,{value:t.category,onChange:s=>o("category",s.target.value),label:"Category",children:[e.jsx(T,{value:"",children:"All"}),n.map(s=>e.jsx(T,{value:s.id,children:s.name},s.id))]})]}),e.jsx(I,{label:"From",type:"date",size:"small",InputLabelProps:{shrink:!0},value:t.dateFrom,onChange:s=>o("dateFrom",s.target.value)}),e.jsx(I,{label:"To",type:"date",size:"small",InputLabelProps:{shrink:!0},value:t.dateTo,onChange:s=>o("dateTo",s.target.value)}),e.jsx(I,{label:"Min Amount",type:"number",size:"small",value:t.minAmount,onChange:s=>o("minAmount",s.target.value)}),e.jsx(I,{label:"Max Amount",type:"number",size:"small",value:t.maxAmount,onChange:s=>o("maxAmount",s.target.value)}),l&&e.jsx(C,{variant:"outlined",startIcon:e.jsx(Te,{}),onClick:i,size:"small",children:"Clear"})]})}function De(t,n,o){const[i,l]=f.useState(1),s=10,[j,x]=f.useState(!1),[p,m]=f.useState(null),[a,d]=f.useState(!1),[u,c]=f.useState(null),h=f.useMemo(()=>{const r=(i-1)*s;return t.slice(r,r+s)},[t,i]),b=Math.ceil(t.length/s);return{page:i,setPage:l,totalPages:b,paginatedTransactions:h,modalOpen:j,selectedTransaction:p,closeModal:()=>{x(!1),m(null)},confirmOpen:a,editTransaction:r=>{m(r),x(!0)},deleteTransaction:r=>{c(r),d(!0)},confirmDelete:()=>{u&&o(u),d(!1),c(null)},cancelDelete:()=>{d(!1),c(null)},saveTransaction:r=>{r.id&&n(r.id,{amount:r.amount,note:r.note,categoryId:r.categoryId,subcategory:r.subcategory}),x(!1),m(null)}}}const Y=({open:t,onClose:n,onSave:o,transaction:i,transactionType:l})=>{const{categories:s,isLoading:j}=U(),x=!!i,p=i?.type||l,[m,a]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(""),[b,v]=f.useState("");f.useEffect(()=>{if(t){if(x&&i)a(i.amount.toString()),u(i.note||""),h(i.categoryId),v(i.subcategory||"");else if(l){const r=s.find(J=>J.type===l);a(""),u(""),h(r?.id||""),v("")}}},[t,i,l,s,x]);const D=s.filter(r=>r.type===p),g=s.find(r=>r.id===c)?.subcategories||[],w=()=>{!m||isNaN(Number(m))||!c||!p||(o({id:i?.id,amount:Number(m),note:d,categoryId:c,subcategory:b||void 0,type:p}),a(""),u(""),h(""),v(""),n())},M=()=>{a(""),u(""),h(""),v(""),n()};return e.jsx(ne,{open:t,onClose:M,anchor:"right",PaperProps:{sx:{width:{xs:"100%",sm:400},borderLeft:"1px solid",borderColor:"divider",backgroundColor:"#000000"}},children:e.jsxs(L,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column",backgroundColor:"#1a1a1a"},children:[e.jsxs(L,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(B,{variant:"h6",sx:{fontWeight:600},children:x?"Edit Transaction":`Add ${p}`}),e.jsx(R,{onClick:M,size:"small",children:e.jsx(se,{})})]}),e.jsx(q,{sx:{mb:3}}),e.jsxs(S,{spacing:3,sx:{flexGrow:1,overflow:"visible"},children:[e.jsxs(F,{fullWidth:!0,children:[e.jsx(P,{children:"Category"}),e.jsx(z,{value:c,label:"Category",onChange:r=>h(r.target.value),children:D.map(r=>e.jsx(T,{value:r.id,children:r.name},r.id))})]}),c&&g.length>0&&e.jsxs(F,{fullWidth:!0,children:[e.jsx(P,{children:"Subcategory (Optional)"}),e.jsxs(z,{value:b,label:"Subcategory (Optional)",onChange:r=>v(r.target.value),children:[e.jsx(T,{value:"",children:"None"}),g.map(r=>e.jsx(T,{value:r,children:r},r))]})]}),e.jsx(I,{label:"Amount",type:"number",value:m,onChange:r=>a(r.target.value),fullWidth:!0,required:!0}),e.jsx(I,{label:"Note",value:d,onChange:r=>u(r.target.value),fullWidth:!0,multiline:!0,rows:3})]}),e.jsx(L,{sx:{mt:3,pt:2,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(S,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(C,{onClick:M,disabled:j,children:"Cancel"}),e.jsx(C,{variant:"contained",onClick:w,disabled:!m||!c||j,children:j?x?"Updating...":"Adding...":x?"Update":"Add Transaction"})]})})]})})},Ie={Income:"success.main",Expense:"error.main",Savings:"info.main"};function Ae({filteredAndSortedTransactions:t,sort:n,getCategoryName:o,onSort:i,onUpdateTransaction:l,onDeleteTransaction:s}){const{page:j,setPage:x,totalPages:p,paginatedTransactions:m,modalOpen:a,selectedTransaction:d,confirmOpen:u,editTransaction:c,deleteTransaction:h,confirmDelete:b,cancelDelete:v,saveTransaction:D,closeModal:A}=De(t,l,s);return e.jsxs(e.Fragment,{children:[e.jsx(xe,{component:ae,children:e.jsxs(me,{children:[e.jsx(pe,{children:e.jsxs(H,{children:[e.jsx(y,{sortDirection:n.field==="date"?n.direction:!1,children:e.jsx(k,{active:n.field==="date",direction:n.field==="date"?n.direction:"asc",onClick:()=>i("date"),children:"Date"})}),e.jsx(y,{sortDirection:n.field==="type"?n.direction:!1,children:e.jsx(k,{active:n.field==="type",direction:n.field==="type"?n.direction:"asc",onClick:()=>i("type"),children:"Type"})}),e.jsx(y,{sortDirection:n.field==="category"?n.direction:!1,children:e.jsx(k,{active:n.field==="category",direction:n.field==="category"?n.direction:"asc",onClick:()=>i("category"),children:"Category"})}),e.jsx(y,{children:"Subcategory"}),e.jsx(y,{sortDirection:n.field==="amount"?n.direction:!1,children:e.jsx(k,{active:n.field==="amount",direction:n.field==="amount"?n.direction:"asc",onClick:()=>i("amount"),children:"Amount"})}),e.jsx(y,{children:"Note"}),e.jsx(y,{align:"right",children:"Actions"})]})}),e.jsx(he,{children:m.map(g=>e.jsxs(H,{children:[e.jsx(y,{children:new Date(g.date).toLocaleDateString()}),e.jsx(y,{children:g.type}),e.jsx(y,{children:o(g.categoryId)}),e.jsx(y,{children:g.subcategory||"-"}),e.jsx(y,{sx:{color:Ie[g.type],fontWeight:"bold"},children:oe(g.amount)}),e.jsx(y,{children:g.note}),e.jsx(y,{align:"right",children:e.jsxs(S,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(R,{color:"primary",onClick:()=>c(g),children:e.jsx(re,{})}),e.jsx(R,{color:"error",onClick:()=>h(g.id),children:e.jsx(ie,{})})]})})]},g.id))})]})}),e.jsx(S,{mt:2,alignItems:"center",children:e.jsx(ge,{count:p,page:j,onChange:(g,w)=>x(w),color:"primary"})}),a&&d&&e.jsx(Y,{open:a,onClose:A,onSave:D,transaction:d}),e.jsxs(le,{open:u,onClose:v,children:[e.jsx(ce,{children:"Confirm Delete"}),e.jsx(de,{children:e.jsx(B,{children:"Are you sure you want to delete this transaction?"})}),e.jsxs(ue,{children:[e.jsx(C,{onClick:v,children:"Cancel"}),e.jsx(C,{color:"error",variant:"contained",onClick:b,children:"Delete"})]})]})]})}function we(){const{user:t}=G(),{addTransaction:n,isLoading:o}=U(),[i,l]=f.useState(!1),[s,j]=f.useState("Income"),x=a=>{j(a),l(!0)},p=()=>l(!1),m=async a=>{if(t)try{await n(t.id,{type:a.type,amount:a.amount,categoryId:a.categoryId,subcategory:a.subcategory,note:a.note,date:new Date().toISOString()}),p()}catch(d){console.error("Failed to add transaction:",d)}};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"flex-end",children:[e.jsx(C,{variant:"contained",startIcon:e.jsx(O,{}),color:"info",onClick:()=>x("Income"),disabled:o,children:"Add Income"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(O,{}),color:"info",onClick:()=>x("Expense"),disabled:o,children:"Add Expense"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(O,{}),color:"info",onClick:()=>x("Savings"),disabled:o,children:"Add Savings"})]}),e.jsx(Y,{open:i,onClose:p,onSave:m,transactionType:s})]})}function Oe(){const{user:t}=G(),{transactions:n,categories:o,updateTransaction:i,deleteTransaction:l}=U(),s=h=>o.find(b=>b.id===h)?.name||"Uncategorized",{filters:j,sort:x,filteredAndSortedTransactions:p,updateFilter:m,updateSort:a,clearFilters:d}=Ce(n,s),u=(h,b)=>{t&&i(t.id,h,b)},c=h=>{t&&l(t.id,h)};return e.jsxs(L,{p:4,children:[e.jsxs(S,{direction:{xs:"column",sm:"row"},justifyContent:{xs:"flex-start",sm:"space-between"},alignItems:"baseline",mb:1,children:[e.jsx(B,{variant:"h5",children:"Transaction Details"}),e.jsx(we,{})]}),e.jsx(q,{sx:{mb:3}}),e.jsx(Se,{filters:j,categories:o,onFilterChange:m,onClearFilters:d}),e.jsx(Ae,{filteredAndSortedTransactions:p,sort:x,getCategoryName:s,onSort:a,onUpdateTransaction:u,onDeleteTransaction:c})]})}export{Oe as default};
