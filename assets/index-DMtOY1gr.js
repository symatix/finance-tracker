const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-7Ccxyq_g.js","assets/index-Cx2DYBn7.css"])))=>i.map(i=>d[i]);
import{x as D,j as e,r as i,m as O,B as x,F as Q,I as X,S as Z,M,T as u,w as R,H as W,J as p,N,v as z,L as P,a3 as k,a4 as oe,A as U,a5 as ce,a6 as de,a7 as he,Y,l as me,C as xe,n as ue}from"./index-7Ccxyq_g.js";import{a as H,b as $,c as q,d as J,E as je,D as ye}from"./Edit-CS56Aevz.js";import{P as fe,A as ve,E as B}from"./PersonAdd-B6gBl-5H.js";import{T as ee,a as te,b as se,c as T,d as c,e as ne}from"./TableRow-LrOC3fnA.js";import{A as ae}from"./Avatar-B4K24QaF.js";import{C as G}from"./Cancel-IKqTZDeu.js";import{D as pe}from"./Divider-8rNOQW4G.js";const V=D(e.jsx("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2m4 18v-6h2.5l-2.54-7.63C19.68 7.55 18.92 7 18.06 7h-.12c-.86 0-1.63.55-1.9 1.37l-.86 2.58c1.08.6 1.82 1.73 1.82 3.05v8zm-7.5-10.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5S11 9.17 11 10s.67 1.5 1.5 1.5M5.5 6c1.11 0 2-.89 2-2s-.89-2-2-2-2 .89-2 2 .89 2 2 2m2 16v-7H9V9c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v6h1.5v7zm6.5 0v-4h1v-4c0-.82-.68-1.5-1.5-1.5h-2c-.82 0-1.5.68-1.5 1.5v4h1v4z"})),ge=D(e.jsx("path",{d:"M22 9V7h-2v2h-2v2h2v2h2v-2h2V9zM8 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 1c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4m4.51-8.95C13.43 5.11 14 6.49 14 8s-.57 2.89-1.49 3.95C14.47 11.7 16 10.04 16 8s-1.53-3.7-3.49-3.95m4.02 9.78C17.42 14.66 18 15.7 18 17v3h2v-3c0-1.45-1.59-2.51-3.47-3.17"})),be=D(e.jsx("path",{d:"M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4m3 2v2h6v-2zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"})),Ce=D(e.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"})),we=D([e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),e.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")]);function Fe({onCreate:n,onUpdate:r,onDelete:m}){const[a,s]=i.useState(!1),[y,f]=i.useState(),{createFamily:j,updateFamily:v,deleteFamily:o}=O(),w=()=>{f(void 0),s(!0)},l=b=>{f(b),s(!0)},t=()=>{s(!1),f(void 0)};return{modalOpen:a,familyToEdit:y,openCreateModal:w,openEditModal:l,closeModal:t,handleCreateFamily:async b=>{try{await j(b),await n(),t()}catch(F){console.error("Failed to create family:",F)}},handleUpdateFamily:async(b,F)=>{try{await v(b,F),await r(),t()}catch(A){console.error("Failed to update family:",A)}},handleDeleteFamily:async b=>{try{await o(b),await m()}catch(F){console.error("Failed to delete family:",F)}}}}function Se({families:n,currentFamilyId:r,onFamilyChange:m}){return i.useEffect(()=>{!r&&n.length>0&&m(n[0].id)},[n,r,m]),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(V,{color:"primary"}),e.jsxs(Q,{size:"small",sx:{minWidth:200},children:[e.jsx(X,{children:"Current Family"}),e.jsxs(Z,{value:r||"",label:"Current Family",onChange:a=>m(a.target.value||null),children:[e.jsx(M,{value:"",children:e.jsx("em",{children:"No family selected"})}),n.map(a=>e.jsx(M,{value:a.id,children:e.jsx(x,{children:e.jsx(u,{variant:"body2",fontWeight:"medium",children:a.name})})},a.id))]})]})]})}function Ie({open:n,onClose:r,onSave:m,initialData:a,userId:s}){const[y,f]=i.useState(""),[j,v]=i.useState(""),[o,w]=i.useState(!1),l=!!a;i.useEffect(()=>{n&&(a?(f(a.name),v(a.description||"")):(f(""),v("")))},[n,a]);const t=async()=>{if(y.trim()){w(!0);try{l&&a?await m({id:a.id,updates:{name:y.trim(),description:j.trim()||null}}):await m({name:y.trim(),description:j.trim()||null,owner_id:s}),r()}catch(g){console.error("Failed to save family:",g)}finally{w(!1)}}},d=()=>{o||r()};return e.jsxs(H,{open:n,onClose:d,maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:l?"Edit Family":"Create New Family"}),e.jsx(q,{children:e.jsxs(R,{spacing:3,sx:{pt:1},children:[e.jsx(W,{label:"Family Name",value:y,onChange:g=>f(g.target.value),required:!0,fullWidth:!0,autoFocus:!0,disabled:o}),e.jsx(W,{label:"Description (Optional)",value:j,onChange:g=>v(g.target.value),multiline:!0,rows:3,fullWidth:!0,disabled:o,placeholder:"Add a description for your family..."}),!l&&e.jsx(u,{variant:"body2",color:"text.secondary",children:"After creating the family, you can invite other members to join and collaborate on your finances."})]})}),e.jsxs(J,{children:[e.jsx(p,{onClick:d,disabled:o,children:"Cancel"}),e.jsx(p,{onClick:t,variant:"contained",disabled:!y.trim()||o,children:o?"Saving...":l?"Update":"Create"})]})]})}function Ae({family:n,onAddMember:r,onRemoveMember:m}){const a=n.members||[];return e.jsxs(x,{children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(u,{variant:"h6",children:"Account Members"}),e.jsx(p,{size:"small",startIcon:e.jsx(fe,{}),onClick:r,variant:"outlined",children:"Add Member"})]}),a.length===0?e.jsx(N,{sx:{p:3,textAlign:"center"},children:e.jsx(u,{variant:"body2",color:"text.secondary",children:"No members yet. Add account members to start collaborating."})}):e.jsx(ee,{component:N,children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsxs(T,{children:[e.jsx(c,{children:"Member"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Joined"}),e.jsx(c,{align:"right",children:"Actions"})]})}),e.jsx(ne,{children:a.map(s=>e.jsxs(T,{children:[e.jsx(c,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ae,{sx:{width:32,height:32,bgcolor:"primary.main"},children:s.user_id.charAt(0).toUpperCase()}),e.jsxs(x,{children:[e.jsxs(u,{variant:"body2",fontWeight:"medium",children:["User ",s.user_id.slice(0,8)]}),s.role==="owner"&&e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[e.jsx(ve,{fontSize:"small",color:"primary"}),e.jsx(u,{variant:"caption",color:"primary",children:"Owner"})]})]})]})}),e.jsx(c,{children:e.jsx(z,{label:s.role,size:"small",color:s.role==="owner"?"primary":"default",variant:s.role==="owner"?"filled":"outlined"})}),e.jsx(c,{children:e.jsx(u,{variant:"body2",color:"text.secondary",children:new Date(s.joined_at).toLocaleDateString()})}),e.jsx(c,{align:"right",children:s.role!=="owner"&&e.jsx(P,{size:"small",onClick:()=>m(s.id),color:"error",title:"Remove member",children:e.jsx(be,{fontSize:"small"})})})]},s.id))})]})})]})}function Ee({familyId:n}){const[r,m]=i.useState([]),[a,s]=i.useState(!0),[y,f]=i.useState(null),j=i.useCallback(async()=>{try{s(!0),f(null);const t=await k.findByFamilyId(n);m(t)}catch(t){f(t instanceof Error?t.message:"Failed to load invitations")}finally{s(!1)}},[n]);i.useEffect(()=>{j()},[j]);const v=async t=>{try{const{supabase:d}=await he(async()=>{const{supabase:b}=await import("./index-7Ccxyq_g.js").then(F=>F.au);return{supabase:b}},__vite__mapDeps([0,1])),{data:{session:g}}=await d.auth.getSession();if(!g?.access_token)throw new Error("No authentication token available");if((await d.functions.invoke("send-invitation",{body:{email:t.email,family_id:t.family_id,role:t.role,invited_by:t.invited_by},headers:{Authorization:`Bearer ${g.access_token}`}})).error)throw new Error("Failed to resend invitation email");alert("Invitation email resent successfully!"),j()}catch(d){alert(d instanceof Error?d.message:"Failed to resend invitation")}},o=async t=>{if(confirm("Are you sure you want to cancel this invitation?"))try{await k.delete(t),j()}catch(d){alert(d instanceof Error?d.message:"Failed to cancel invitation")}},w=t=>{switch(t){case"pending":return e.jsx(we,{color:"warning"});case"accepted":return e.jsx(de,{color:"success"});case"expired":return e.jsx(ce,{color:"error"});case"cancelled":return e.jsx(G,{color:"error"});default:return e.jsx(B,{})}},l=t=>{switch(t){case"pending":return"warning";case"accepted":return"success";case"expired":case"cancelled":return"error";default:return"default"}};return a?e.jsxs(x,{sx:{textAlign:"center",py:4},children:[e.jsx(oe,{size:24}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Loading invitations..."})]}):r.length===0?null:e.jsxs(x,{sx:{mt:4},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(u,{variant:"h6",children:"Pending Invitations"}),e.jsx(p,{size:"small",startIcon:e.jsx(Ce,{}),onClick:j,disabled:a,children:"Refresh"})]}),y&&e.jsx(U,{severity:"error",sx:{mb:2},children:y}),e.jsx(ee,{component:N,children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsxs(T,{children:[e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Sent"}),e.jsx(c,{children:"Expires"}),e.jsx(c,{align:"right",children:"Actions"})]})}),e.jsx(ne,{children:r.map(t=>e.jsxs(T,{children:[e.jsx(c,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ae,{sx:{width:32,height:32,bgcolor:"secondary.main"},children:e.jsx(B,{fontSize:"small"})}),e.jsx(u,{variant:"body2",children:t.email})]})}),e.jsx(c,{children:e.jsx(z,{label:t.role,size:"small",color:"primary",variant:"outlined"})}),e.jsx(c,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[w(t.status),e.jsx(z,{label:t.status,size:"small",color:l(t.status),variant:"filled"})]})}),e.jsx(c,{children:e.jsx(u,{variant:"body2",color:"text.secondary",children:new Date(t.created_at).toLocaleDateString()})}),e.jsx(c,{children:e.jsx(u,{variant:"body2",color:"text.secondary",children:t.expires_at?new Date(t.expires_at).toLocaleDateString():"N/A"})}),e.jsx(c,{align:"right",children:t.status==="pending"&&e.jsxs(x,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(P,{size:"small",onClick:()=>v(t),color:"primary",title:"Resend invitation",children:e.jsx(B,{fontSize:"small"})}),e.jsx(P,{size:"small",onClick:()=>o(t.id),color:"error",title:"Cancel invitation",children:e.jsx(G,{fontSize:"small"})})]})})]},t.id))})]})})]})}function Me({open:n,onClose:r,familyId:m,onMemberAdded:a}){const[s,y]=i.useState(""),[f,j]=i.useState("member"),[v,o]=i.useState(!1),[w,l]=i.useState(null),[t,d]=i.useState(null);i.useEffect(()=>{n&&s.trim()?g():d(null)},[n,s]);const g=async()=>{if(!s.trim()){d(null);return}try{const S=(await k.findByFamilyId(m)).find(C=>C.email.toLowerCase()===s.trim().toLowerCase()&&C.status==="pending");d(S||null)}catch(h){console.error("Failed to check existing invitation:",h)}},E=async()=>{if(t){o(!0),l(null);try{const{data:{session:h}}=await Y.auth.getSession();if(!h?.access_token)throw new Error("No authentication token available");if((await Y.functions.invoke("send-invitation",{body:{email:t.email,family_id:t.family_id,role:t.role,invited_by:t.invited_by},headers:{Authorization:`Bearer ${h.access_token}`}})).error)throw new Error("Failed to resend invitation email");l(null),alert("Invitation email resent successfully!")}catch(h){l(h instanceof Error?h.message:"Failed to resend invitation")}finally{o(!1)}}},b=async()=>{if(t&&confirm("Are you sure you want to cancel this pending invitation?")){o(!0),l(null);try{await k.delete(t.id),d(null),l(null)}catch(h){l(h instanceof Error?h.message:"Failed to cancel invitation")}finally{o(!1)}}},F=async h=>{if(h.preventDefault(),!(!s.trim()||t)){o(!0),l(null);try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.trim()))throw new Error("Please enter a valid email address");await k.createInvitation(s.trim(),m,f),a(),A()}catch(S){l(S instanceof Error?S.message:"Failed to send invitation")}finally{o(!1)}}},A=()=>{y(""),j("member"),l(null),r()};return e.jsx(H,{open:n,onClose:A,maxWidth:"sm",fullWidth:!0,children:e.jsxs("form",{onSubmit:F,children:[e.jsx($,{children:"Add Account Member"}),e.jsxs(q,{children:[w&&e.jsx(U,{severity:"error",sx:{mb:2},children:w}),e.jsx(W,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",helperText:"Enter the email address of the person you want to invite",fullWidth:!0,variant:"outlined",value:s,onChange:h=>y(h.target.value),placeholder:"user@example.com",required:!0,sx:{mb:2}}),t&&e.jsxs(U,{severity:"info",sx:{mb:2},children:[e.jsx(u,{variant:"body2",gutterBottom:!0,children:"This email has already been invited to this account."}),e.jsxs(x,{sx:{mt:1},children:[e.jsx(z,{label:`Role: ${t.role}`,size:"small",color:"primary",sx:{mr:1}}),e.jsx(z,{label:`Invited: ${new Date(t.created_at).toLocaleDateString()}`,size:"small",variant:"outlined"})]}),e.jsxs(x,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(p,{size:"small",variant:"outlined",onClick:E,disabled:v,children:"Resend Email"}),e.jsx(p,{size:"small",color:"error",onClick:b,disabled:v,children:"Cancel Invitation"})]})]}),e.jsxs(Q,{fullWidth:!0,margin:"dense",disabled:!!t,children:[e.jsx(X,{children:"Role"}),e.jsxs(Z,{value:f,label:"Role",onChange:h=>j(h.target.value),children:[e.jsx(M,{value:"viewer",children:"Viewer - Can only view shared resources"}),e.jsx(M,{value:"member",children:"Member - Can view and manage shared resources"}),e.jsx(M,{value:"admin",children:"Admin - Can manage members and resources"})]})]})]}),e.jsxs(J,{children:[e.jsx(p,{onClick:A,disabled:v,children:"Cancel"}),e.jsx(p,{type:"submit",variant:"contained",disabled:v||!s.trim()||!!t,children:v?"Sending Invite...":"Send Invitation"})]})]})})}function Be(){const{user:n}=me(),{families:r,currentFamilyId:m,isLoading:a,loadFamilies:s,setCurrentFamily:y}=O(),[f,j]=i.useState(0),[v,o]=i.useState(!1);i.useEffect(()=>{n&&r.length===0&&s(n.id)},[n,r.length,s]);const{modalOpen:w,familyToEdit:l,openCreateModal:t,openEditModal:d,closeModal:g,handleCreateFamily:E,handleUpdateFamily:b,handleDeleteFamily:F}=Fe({onCreate:async()=>{n&&await s(n.id)},onUpdate:async()=>{n&&await s(n.id)},onDelete:async()=>{n&&await s(n.id)}}),A=()=>{o(!0)},h=async()=>{n&&await s(n.id),j(I=>I+1)},S=async I=>{try{await O.getState().removeFamilyMember(I),n&&await s(n.id)}catch(_){console.error("Failed to remove member:",_)}},C=r.find(I=>I.id===m),[ie,L]=i.useState(!1),re=()=>{L(!0)},le=()=>{L(!1),C&&F(C.id)},K=()=>{L(!1)};return e.jsxs(x,{p:4,children:[e.jsxs(R,{direction:{xs:"column",sm:"row"},justifyContent:{xs:"flex-start",sm:"space-between"},alignItems:"center",mb:1,children:[e.jsx(u,{variant:"h5",children:"Account Management"}),e.jsx(R,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"flex-end",children:e.jsx(p,{variant:"contained",startIcon:e.jsx(V,{}),onClick:t,disabled:a,children:"Create Family Account"})})]}),e.jsx(pe,{sx:{mb:3}}),r.length>0&&e.jsx(e.Fragment,{children:e.jsxs(x,{mb:3,sx:{display:"flex",gap:2,justifyContent:"space-between"},children:[e.jsx(Se,{families:r,currentFamilyId:m,onFamilyChange:y}),e.jsxs(x,{children:[e.jsx(p,{sx:{mr:2},variant:"outlined",startIcon:e.jsx(je,{}),onClick:()=>d(C),children:"Edit Family"}),e.jsx(p,{variant:"outlined",color:"error",startIcon:e.jsx(ye,{}),onClick:re,children:"Delete Family"})]})]})}),C?e.jsxs(R,{spacing:3,children:[e.jsx(Ae,{family:C,onAddMember:A,onRemoveMember:S}),e.jsx(Ee,{familyId:C.id},f)]}):e.jsx(xe,{children:e.jsxs(ue,{sx:{textAlign:"center",py:6},children:[e.jsx(V,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(u,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Account Selected"}),e.jsx(u,{variant:"body2",color:"text.secondary",mb:3,children:"Create or join an account to start collaborating on your finances."}),e.jsx(p,{variant:"contained",startIcon:e.jsx(ge,{}),onClick:t,disabled:a,children:"Create Your First Account"})]})}),e.jsx(Ie,{open:w,onClose:g,onSave:async I=>{if(l){const _=I;await b(_.id,_.updates)}else await E(I)},initialData:l,userId:n?.id||""}),C&&e.jsx(Me,{open:v,onClose:()=>o(!1),familyId:C.id,onMemberAdded:h}),C&&e.jsxs(H,{open:ie,onClose:K,children:[e.jsx($,{children:"Delete Family"}),e.jsxs(q,{children:[e.jsxs(u,{children:['Are you sure you want to delete the family "',C.name,'"?']}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This action cannot be undone. All family members will be removed and shared resources will no longer be accessible."})]}),e.jsxs(J,{children:[e.jsx(p,{onClick:K,children:"Cancel"}),e.jsx(p,{onClick:le,color:"error",variant:"contained",children:"Delete Family"})]})]})]})}export{Be as default};
