import{r as x,j as e,P as H,t as D,T as E,H as w,G as R,B as N,F as K,I as U,S as _,M,D as z,E as F,l as q,m as J}from"./index-pDMVrzzH.js";import{E as G,D as L,C as Q,A as P,a as X,b as Y,c as Z,d as $}from"./Edit-DHcjPJjN.js";import{T as ee,a as te,b as se,c as O,d as v,e as ae}from"./TableRow-SUwbmtEy.js";import{C as ne}from"./Chip-PuIzE2sX.js";import{D as V}from"./Divider-CyUvQA4o.js";import{S as re,C as oe}from"./Save-D3TqOTcw.js";function ie({categories:n,transactionCategoryIds:a,onAdd:c,onUpdate:t,onDelete:g}){const[C,i]=x.useState(!1),[l,y]=x.useState(null),[d,h]=x.useState(!1),[m,p]=x.useState(null),[u,f]=x.useState(!1),T=n.find(r=>r.id===l),I=()=>{y(null),i(!0)},A=r=>{y(r),i(!0)},k=()=>{i(!1),y(null)};return{modalOpen:C,editCategoryId:l,categoryToEdit:T,confirmOpen:d,hasTransactions:u,openAddModal:I,openEditModal:A,closeModal:k,handleSave:async(r,b,B)=>{try{l&&T?await t(l,r,b,B):await c(r,b,B),k()}catch(W){console.error("Failed to save category:",W)}},openConfirmDialog:r=>{const b=a.includes(r);p(r),f(b),h(!0)},handleConfirmDelete:async()=>{try{m&&!u&&await g(m),h(!1),p(null),f(!1)}catch(r){console.error("Failed to delete category:",r)}},handleCancelDelete:()=>{h(!1),p(null),f(!1)}}}function le({categories:n,onEdit:a,onDelete:c}){return e.jsx(ee,{component:H,children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsxs(O,{children:[e.jsx(v,{children:"Name"}),e.jsx(v,{children:"Type"}),e.jsx(v,{children:"Subcategories"}),e.jsx(v,{align:"right",children:"Actions"})]})}),e.jsx(ae,{children:n.map(t=>e.jsxs(O,{children:[e.jsx(v,{children:t.name}),e.jsx(v,{children:t.type}),e.jsx(v,{children:e.jsxs(D,{direction:"row",spacing:1,flexWrap:"wrap",children:[t.subcategories?.map(g=>e.jsx(ne,{label:g,size:"small"},g)),(!t.subcategories||t.subcategories.length===0)&&e.jsx(E,{variant:"body2",color:"text.secondary",children:"No subcategories"})]})}),e.jsx(v,{align:"right",children:e.jsxs(D,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(w,{color:"primary",onClick:()=>a(t.id),children:e.jsx(G,{})}),e.jsx(w,{color:"error",onClick:()=>c(t.id),children:e.jsx(L,{})})]})})]},t.id))})]})})}function ce({open:n,initialData:a}){const[c,t]=x.useState(""),[g,C]=x.useState("Expense"),[i,l]=x.useState([]),[y,d]=x.useState(""),[h,m]=x.useState(null),[p,u]=x.useState("");return x.useEffect(()=>{n&&(t(a?.name||""),C(a?.type||"Expense"),l(a?.subcategories?[...a.subcategories]:[]),d(""),m(null),u(""))},[n,a]),{name:c,type:g,subcategories:i,newSubcategoryName:y,editingIndex:h,editingName:p,setName:t,setType:C,setNewSubcategoryName:d,setEditingName:u,addSubcategory:()=>{const o=y.trim();o&&(l([...i,o]),d(""))},startEditSubcategory:o=>{m(o),u(i[o])},saveEditSubcategory:()=>{const o=p.trim();if(!o||h===null)return;const s=[...i];s[h]=o,l(s),m(null),u("")},cancelEditSubcategory:()=>{m(null),u("")},deleteSubcategory:o=>{l(i.filter((s,r)=>r!==o))},getFormData:()=>({name:c.trim(),type:g,subcategories:i}),isValid:()=>c.trim().length>0}}function de({open:n,onClose:a,onSave:c,initialData:t}){const{name:g,type:C,subcategories:i,newSubcategoryName:l,editingIndex:y,editingName:d,setName:h,setType:m,setNewSubcategoryName:p,setEditingName:u,addSubcategory:f,startEditSubcategory:T,saveEditSubcategory:I,cancelEditSubcategory:A,deleteSubcategory:k,getFormData:j,isValid:S}=ce({open:n,initialData:t}),o=()=>{if(!S())return;const s=j();c(s.name,s.type,s.subcategories)};return e.jsx(R,{open:n,onClose:a,anchor:"right",PaperProps:{sx:{width:{xs:"100%",sm:400},borderLeft:"1px solid",borderColor:"divider",backgroundColor:"#000000"}},children:e.jsxs(N,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column",backgroundColor:"#1a1a1a"},children:[e.jsxs(N,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(E,{variant:"h6",sx:{fontWeight:600},children:t?"Edit Category":"Add Category"}),e.jsx(w,{onClick:a,size:"small",children:e.jsx(Q,{})})]}),e.jsx(V,{sx:{mb:3}}),e.jsxs(D,{spacing:3,sx:{flexGrow:1,overflow:"visible"},children:[e.jsxs(K,{fullWidth:!0,children:[e.jsx(U,{children:"Type"}),e.jsxs(_,{value:C,label:"Type",onChange:s=>m(s.target.value),autoFocus:!0,children:[e.jsx(M,{value:"Income",children:"Income"}),e.jsx(M,{value:"Expense",children:"Expense"}),e.jsx(M,{value:"Savings",children:"Savings"})]})]}),e.jsx(z,{label:"Name",value:g,onChange:s=>h(s.target.value),fullWidth:!0}),e.jsxs(N,{children:[e.jsx(E,{variant:"h6",gutterBottom:!0,children:"Subcategories"}),e.jsxs(D,{direction:"row",spacing:1,alignItems:"center",mb:2,children:[e.jsx(z,{size:"small",placeholder:"Add subcategory",value:l,onChange:s=>p(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),f())},sx:{flexGrow:1}}),e.jsx(w,{color:"primary",onClick:f,disabled:!l.trim(),children:e.jsx(P,{})})]}),e.jsxs(D,{spacing:1,children:[i.map((s,r)=>e.jsx(N,{display:"flex",alignItems:"center",gap:1,children:y===r?e.jsxs(e.Fragment,{children:[e.jsx(z,{size:"small",value:d,onChange:b=>u(b.target.value),onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),I())},sx:{flexGrow:1}}),e.jsx(w,{color:"primary",size:"small",onClick:I,children:e.jsx(re,{})}),e.jsx(w,{size:"small",onClick:A,children:e.jsx(oe,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{sx:{flexGrow:1,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,display:"flex",alignItems:"center"},children:e.jsx(E,{variant:"body2",children:s})}),e.jsx(w,{size:"small",onClick:()=>T(r),children:e.jsx(G,{})}),e.jsx(w,{size:"small",color:"error",onClick:()=>k(r),children:e.jsx(L,{})})]})},r)),i.length===0&&e.jsx(E,{variant:"body2",color:"text.secondary",style:{fontStyle:"italic"},children:"No subcategories added yet"})]})]})]}),e.jsx(N,{sx:{mt:3,pt:2,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(D,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(F,{onClick:a,children:"Cancel"}),e.jsx(F,{variant:"contained",onClick:o,disabled:!S(),children:"Save"})]})})]})})}function ue({open:n,hasTransactions:a,onConfirm:c,onCancel:t}){return e.jsxs(X,{open:n,onClose:t,children:[e.jsx(Y,{children:"Confirm Deletion"}),e.jsx(Z,{children:a?e.jsx(E,{color:"error",children:"Cannot delete this category! There are transactions attached to it."}):e.jsx(E,{children:"Are you sure you want to delete this category?"})}),e.jsxs($,{children:[e.jsx(F,{onClick:t,children:"Cancel"}),e.jsx(F,{onClick:c,color:"error",variant:"contained",disabled:a,children:"Delete"})]})]})}function pe(){const{user:n}=q(),{categories:a,transactions:c,addCategory:t,updateCategory:g,deleteCategory:C,isLoading:i}=J(),l=[...new Set(c.map(j=>j.categoryId))],{modalOpen:y,categoryToEdit:d,confirmOpen:h,hasTransactions:m,openAddModal:p,openEditModal:u,closeModal:f,handleSave:T,openConfirmDialog:I,handleConfirmDelete:A,handleCancelDelete:k}=ie({categories:a,transactionCategoryIds:l,onAdd:async(j,S,o)=>{n&&await t(n.id,{name:j,type:S,subcategories:o})},onUpdate:async(j,S,o,s)=>{n&&await g(n.id,j,{name:S,type:o,subcategories:s})},onDelete:async j=>{n&&await C(n.id,j)}});return e.jsxs(N,{p:4,children:[e.jsxs(D,{direction:{xs:"column",sm:"row"},justifyContent:{xs:"flex-start",sm:"space-between"},alignItems:"center",mb:1,children:[e.jsx(E,{variant:"h5",children:"Categories"}),e.jsx(D,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"flex-end",children:e.jsx(F,{variant:"contained",startIcon:e.jsx(P,{}),color:"primary",onClick:p,disabled:i,children:i?"Loading...":"Add Category"})})]}),e.jsx(V,{sx:{mb:3}}),e.jsx(le,{categories:a,onEdit:u,onDelete:I}),e.jsx(de,{open:y,onClose:f,onSave:T,initialData:d?{name:d.name,type:d.type,subcategories:d.subcategories||[]}:void 0}),e.jsx(ue,{open:h,hasTransactions:m,onConfirm:A,onCancel:k})]})}export{pe as default};
