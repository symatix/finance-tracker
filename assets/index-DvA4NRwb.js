import{w as B,j as a,f as ge,g as xe,r as u,h as be,L as fe,C as Y,c as A,y as Z,k as oe,z as n,b as ye,A as Ce,D as K,P as ve,t as R,T as N,J as P,H as me,B as L,F as he,I as je,S as Se,M as G,E as J,G as O,K as $e,m as ke}from"./index-75GZXKmA.js";import{T as Ie,a as we,b as De,c as ee,d as z,e as Te,E as te,D as re,C as Ee,f as ze,g as Pe,h as Re,i as Ne}from"./Edit-CZ1aIbov.js";import{D as le}from"./Divider-CfBqejFn.js";const Me=B(a.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}));function Le(e){return xe("MuiChip",e)}const l=ge("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),Oe=e=>{const{classes:o,disabled:t,size:r,color:i,iconColor:v,onDelete:c,clickable:s,variant:p}=e,x={root:["root",p,t&&"disabled",`size${n(r)}`,`color${n(i)}`,s&&"clickable",s&&`clickableColor${n(i)}`,c&&"deletable",c&&`deletableColor${n(i)}`,`${p}${n(i)}`],label:["label",`label${n(r)}`],avatar:["avatar",`avatar${n(r)}`,`avatarColor${n(i)}`],icon:["icon",`icon${n(r)}`,`iconColor${n(v)}`],deleteIcon:["deleteIcon",`deleteIcon${n(r)}`,`deleteIconColor${n(i)}`,`deleteIcon${n(p)}Color${n(i)}`]};return ye(x,Le,o)},Fe=oe("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:t}=e,{color:r,iconColor:i,clickable:v,onDelete:c,size:s,variant:p}=t;return[{[`& .${l.avatar}`]:o.avatar},{[`& .${l.avatar}`]:o[`avatar${n(s)}`]},{[`& .${l.avatar}`]:o[`avatarColor${n(r)}`]},{[`& .${l.icon}`]:o.icon},{[`& .${l.icon}`]:o[`icon${n(s)}`]},{[`& .${l.icon}`]:o[`iconColor${n(i)}`]},{[`& .${l.deleteIcon}`]:o.deleteIcon},{[`& .${l.deleteIcon}`]:o[`deleteIcon${n(s)}`]},{[`& .${l.deleteIcon}`]:o[`deleteIconColor${n(r)}`]},{[`& .${l.deleteIcon}`]:o[`deleteIcon${n(p)}Color${n(r)}`]},o.root,o[`size${n(s)}`],o[`color${n(r)}`],v&&o.clickable,v&&r!=="default"&&o[`clickableColor${n(r)})`],c&&o.deletable,c&&r!=="default"&&o[`deletableColor${n(r)}`],o[p],o[`${p}${n(r)}`]]}})(Ce(({theme:e})=>{const o=e.palette.mode==="light"?e.palette.grey[700]:e.palette.grey[300];return{maxWidth:"100%",fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,lineHeight:1.5,color:(e.vars||e).palette.text.primary,backgroundColor:(e.vars||e).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:e.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${l.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${l.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:e.vars?e.vars.palette.Chip.defaultAvatarColor:o,fontSize:e.typography.pxToRem(12)},[`& .${l.avatarColorPrimary}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.dark},[`& .${l.avatarColorSecondary}`]:{color:(e.vars||e).palette.secondary.contrastText,backgroundColor:(e.vars||e).palette.secondary.dark},[`& .${l.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:e.typography.pxToRem(10)},[`& .${l.icon}`]:{marginLeft:5,marginRight:-6},[`& .${l.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:e.alpha((e.vars||e).palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:e.alpha((e.vars||e).palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${l.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${l.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(e.palette).filter(K(["contrastText"])).map(([t])=>({props:{color:t},style:{backgroundColor:(e.vars||e).palette[t].main,color:(e.vars||e).palette[t].contrastText,[`& .${l.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[t].contrastText,.7),"&:hover, &:active":{color:(e.vars||e).palette[t].contrastText}}}})),{props:t=>t.iconColor===t.color,style:{[`& .${l.icon}`]:{color:e.vars?e.vars.palette.Chip.defaultIconColor:o}}},{props:t=>t.iconColor===t.color&&t.color!=="default",style:{[`& .${l.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}}},...Object.entries(e.palette).filter(K(["dark"])).map(([t])=>({props:{color:t,onDelete:!0},style:{[`&.${l.focusVisible}`]:{background:(e.vars||e).palette[t].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)},[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)},"&:active":{boxShadow:(e.vars||e).shadows[1]}}},...Object.entries(e.palette).filter(K(["dark"])).map(([t])=>({props:{color:t,clickable:!0},style:{[`&:hover, &.${l.focusVisible}`]:{backgroundColor:(e.vars||e).palette[t].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:e.vars?`1px solid ${e.vars.palette.Chip.defaultBorder}`:`1px solid ${e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[700]}`,[`&.${l.clickable}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${l.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`& .${l.avatar}`]:{marginLeft:4},[`& .${l.avatarSmall}`]:{marginLeft:2},[`& .${l.icon}`]:{marginLeft:4},[`& .${l.iconSmall}`]:{marginLeft:2},[`& .${l.deleteIcon}`]:{marginRight:5},[`& .${l.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(e.palette).filter(K()).map(([t])=>({props:{variant:"outlined",color:t},style:{color:(e.vars||e).palette[t].main,border:`1px solid ${e.alpha((e.vars||e).palette[t].main,.7)}`,[`&.${l.clickable}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)},[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.focusOpacity)},[`& .${l.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[t].main,.7),"&:hover, &:active":{color:(e.vars||e).palette[t].main}}}}))]}})),Ve=oe("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,o)=>{const{ownerState:t}=e,{size:r}=t;return[o.label,o[`label${n(r)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function ae(e){return e.key==="Backspace"||e.key==="Delete"}const Ae=u.forwardRef(function(o,t){const r=be({props:o,name:"MuiChip"}),{avatar:i,className:v,clickable:c,color:s="default",component:p,deleteIcon:x,disabled:m=!1,icon:y,label:S,onClick:h,onDelete:C,onKeyDown:k,onKeyUp:I,size:T="medium",variant:D="filled",tabIndex:j,skipFocusWhenDisabled:w=!1,slots:b={},slotProps:d={},...g}=r,$=u.useRef(null),F=fe($,t),V=f=>{f.stopPropagation(),C&&C(f)},ne=f=>{f.currentTarget===f.target&&ae(f)&&f.preventDefault(),k&&k(f)},ie=f=>{f.currentTarget===f.target&&C&&ae(f)&&C(f),I&&I(f)},H=c!==!1&&h?!0:c,U=H||C?Y:p||"div",W={...r,component:U,disabled:m,size:T,color:s,iconColor:u.isValidElement(y)&&y.props.color||s,onDelete:!!C,clickable:H,variant:D},M=Oe(W),se=U===Y?{component:p||"div",focusVisibleClassName:M.focusVisible,...C&&{disableRipple:!0}}:{};let _=null;C&&(_=x&&u.isValidElement(x)?u.cloneElement(x,{className:A(x.props.className,M.deleteIcon),onClick:V}):a.jsx(Me,{className:M.deleteIcon,onClick:V}));let q=null;i&&u.isValidElement(i)&&(q=u.cloneElement(i,{className:A(M.avatar,i.props.className)}));let Q=null;y&&u.isValidElement(y)&&(Q=u.cloneElement(y,{className:A(M.icon,y.props.className)}));const X={slots:b,slotProps:d},[ce,de]=Z("root",{elementType:Fe,externalForwardedProps:{...X,...g},ownerState:W,shouldForwardComponentProp:!0,ref:F,className:A(M.root,v),additionalProps:{disabled:H&&m?!0:void 0,tabIndex:w&&m?-1:j,...se},getSlotProps:f=>({...f,onClick:E=>{f.onClick?.(E),h?.(E)},onKeyDown:E=>{f.onKeyDown?.(E),ne(E)},onKeyUp:E=>{f.onKeyUp?.(E),ie(E)}})}),[pe,ue]=Z("label",{elementType:Ve,externalForwardedProps:X,ownerState:W,className:M.label});return a.jsxs(ce,{as:U,...de,children:[q||Q,a.jsx(pe,{...ue,children:S}),_]})}),Ke=B(a.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),Be=B(a.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),He=B(a.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}));function Ue({categories:e,transactionCategoryIds:o,onAdd:t,onUpdate:r,onDelete:i}){const[v,c]=u.useState(!1),[s,p]=u.useState(null),[x,m]=u.useState(!1),[y,S]=u.useState(null),[h,C]=u.useState(!1),k=e.find(g=>g.id===s),I=()=>{p(null),c(!0)},T=g=>{p(g),c(!0)},D=()=>{c(!1),p(null)};return{modalOpen:v,editCategoryId:s,categoryToEdit:k,confirmOpen:x,hasTransactions:h,openAddModal:I,openEditModal:T,closeModal:D,handleSave:async(g,$,F)=>{try{s&&k?await r(s,g,$,F):await t(g,$,F),D()}catch(V){console.error("Failed to save category:",V)}},openConfirmDialog:g=>{const $=o.includes(g);S(g),C($),m(!0)},handleConfirmDelete:async()=>{try{y&&!h&&await i(y),m(!1),S(null),C(!1)}catch(g){console.error("Failed to delete category:",g)}},handleCancelDelete:()=>{m(!1),S(null),C(!1)}}}function We({categories:e,onEdit:o,onDelete:t}){return a.jsx(Ie,{component:ve,children:a.jsxs(we,{children:[a.jsx(De,{children:a.jsxs(ee,{children:[a.jsx(z,{children:"Name"}),a.jsx(z,{children:"Type"}),a.jsx(z,{children:"Subcategories"}),a.jsx(z,{align:"right",children:"Actions"})]})}),a.jsx(Te,{children:e.map(r=>a.jsxs(ee,{children:[a.jsx(z,{children:r.name}),a.jsx(z,{children:r.type}),a.jsx(z,{children:a.jsxs(R,{direction:"row",spacing:1,flexWrap:"wrap",children:[r.subcategories?.map(i=>a.jsx(Ae,{label:i,size:"small"},i)),(!r.subcategories||r.subcategories.length===0)&&a.jsx(N,{variant:"body2",color:"text.secondary",children:"No subcategories"})]})}),a.jsx(z,{align:"right",children:a.jsxs(R,{direction:"row",spacing:1,justifyContent:"flex-end",children:[a.jsx(P,{color:"primary",onClick:()=>o(r.id),children:a.jsx(te,{})}),a.jsx(P,{color:"error",onClick:()=>t(r.id),children:a.jsx(re,{})})]})})]},r.id))})]})})}function Ge({open:e,initialData:o}){const[t,r]=u.useState(""),[i,v]=u.useState("Expense"),[c,s]=u.useState([]),[p,x]=u.useState(""),[m,y]=u.useState(null),[S,h]=u.useState("");return u.useEffect(()=>{e&&(r(o?.name||""),v(o?.type||"Expense"),s(o?.subcategories?[...o.subcategories]:[]),x(""),y(null),h(""))},[e,o]),{name:t,type:i,subcategories:c,newSubcategoryName:p,editingIndex:m,editingName:S,setName:r,setType:v,setNewSubcategoryName:x,setEditingName:h,addSubcategory:()=>{const b=p.trim();b&&(s([...c,b]),x(""))},startEditSubcategory:b=>{y(b),h(c[b])},saveEditSubcategory:()=>{const b=S.trim();if(!b||m===null)return;const d=[...c];d[m]=b,s(d),y(null),h("")},cancelEditSubcategory:()=>{y(null),h("")},deleteSubcategory:b=>{s(c.filter((d,g)=>g!==b))},getFormData:()=>({name:t.trim(),type:i,subcategories:c}),isValid:()=>t.trim().length>0}}function Je({open:e,onClose:o,onSave:t,initialData:r}){const{name:i,type:v,subcategories:c,newSubcategoryName:s,editingIndex:p,editingName:x,setName:m,setType:y,setNewSubcategoryName:S,setEditingName:h,addSubcategory:C,startEditSubcategory:k,saveEditSubcategory:I,cancelEditSubcategory:T,deleteSubcategory:D,getFormData:j,isValid:w}=Ge({open:e,initialData:r}),b=()=>{if(!w())return;const d=j();t(d.name,d.type,d.subcategories)};return a.jsx(me,{open:e,onClose:o,anchor:"right",PaperProps:{sx:{width:{xs:"100%",sm:400},borderLeft:"1px solid",borderColor:"divider",backgroundColor:"#000000"}},children:a.jsxs(L,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column",backgroundColor:"#1a1a1a"},children:[a.jsxs(L,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[a.jsx(N,{variant:"h6",sx:{fontWeight:600},children:r?"Edit Category":"Add Category"}),a.jsx(P,{onClick:o,size:"small",children:a.jsx(Ee,{})})]}),a.jsx(le,{sx:{mb:3}}),a.jsxs(R,{spacing:3,sx:{flexGrow:1,overflow:"visible"},children:[a.jsxs(he,{fullWidth:!0,children:[a.jsx(je,{children:"Type"}),a.jsxs(Se,{value:v,label:"Type",onChange:d=>y(d.target.value),autoFocus:!0,children:[a.jsx(G,{value:"Income",children:"Income"}),a.jsx(G,{value:"Expense",children:"Expense"}),a.jsx(G,{value:"Savings",children:"Savings"})]})]}),a.jsx(J,{label:"Name",value:i,onChange:d=>m(d.target.value),fullWidth:!0}),a.jsxs(L,{children:[a.jsx(N,{variant:"h6",gutterBottom:!0,children:"Subcategories"}),a.jsxs(R,{direction:"row",spacing:1,alignItems:"center",mb:2,children:[a.jsx(J,{size:"small",placeholder:"Add subcategory",value:s,onChange:d=>S(d.target.value),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),C())},sx:{flexGrow:1}}),a.jsx(P,{color:"primary",onClick:C,disabled:!s.trim(),children:a.jsx(Ke,{})})]}),a.jsxs(R,{spacing:1,children:[c.map((d,g)=>a.jsx(L,{display:"flex",alignItems:"center",gap:1,children:p===g?a.jsxs(a.Fragment,{children:[a.jsx(J,{size:"small",value:x,onChange:$=>h($.target.value),onKeyDown:$=>{$.key==="Enter"&&($.preventDefault(),I())},sx:{flexGrow:1}}),a.jsx(P,{color:"primary",size:"small",onClick:I,children:a.jsx(He,{})}),a.jsx(P,{size:"small",onClick:T,children:a.jsx(Be,{})})]}):a.jsxs(a.Fragment,{children:[a.jsx(L,{sx:{flexGrow:1,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,display:"flex",alignItems:"center"},children:a.jsx(N,{variant:"body2",children:d})}),a.jsx(P,{size:"small",onClick:()=>k(g),children:a.jsx(te,{})}),a.jsx(P,{size:"small",color:"error",onClick:()=>D(g),children:a.jsx(re,{})})]})},g)),c.length===0&&a.jsx(N,{variant:"body2",color:"text.secondary",style:{fontStyle:"italic"},children:"No subcategories added yet"})]})]})]}),a.jsx(L,{sx:{mt:3,pt:2,borderTop:"1px solid",borderColor:"divider"},children:a.jsxs(R,{direction:"row",spacing:2,justifyContent:"flex-end",children:[a.jsx(O,{onClick:o,children:"Cancel"}),a.jsx(O,{variant:"contained",onClick:b,disabled:!w(),children:"Save"})]})})]})})}function _e({open:e,hasTransactions:o,onConfirm:t,onCancel:r}){return a.jsxs(ze,{open:e,onClose:r,children:[a.jsx(Pe,{children:"Confirm Deletion"}),a.jsx(Re,{children:o?a.jsx(N,{color:"error",children:"Cannot delete this category! There are transactions attached to it."}):a.jsx(N,{children:"Are you sure you want to delete this category?"})}),a.jsxs(Ne,{children:[a.jsx(O,{onClick:r,children:"Cancel"}),a.jsx(O,{onClick:t,color:"error",variant:"contained",disabled:o,children:"Delete"})]})]})}function Ye(){const{user:e}=$e(),{categories:o,transactions:t,addCategory:r,updateCategory:i,deleteCategory:v,isLoading:c}=ke(),s=[...new Set(t.map(j=>j.categoryId))],{modalOpen:p,categoryToEdit:x,confirmOpen:m,hasTransactions:y,openAddModal:S,openEditModal:h,closeModal:C,handleSave:k,openConfirmDialog:I,handleConfirmDelete:T,handleCancelDelete:D}=Ue({categories:o,transactionCategoryIds:s,onAdd:async(j,w,b)=>{e&&await r(e.id,{name:j,type:w,subcategories:b})},onUpdate:async(j,w,b,d)=>{e&&await i(e.id,j,{name:w,type:b,subcategories:d})},onDelete:async j=>{e&&await v(e.id,j)}});return a.jsxs(L,{p:4,children:[a.jsxs(R,{direction:{xs:"column",sm:"row"},justifyContent:{xs:"flex-start",sm:"space-between"},alignItems:"center",mb:1,children:[a.jsx(N,{variant:"h5",children:"Categories"}),a.jsx(R,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"flex-end",children:a.jsx(O,{variant:"outlined",color:"primary",onClick:S,disabled:c,children:c?"Loading...":"Add Category"})})]}),a.jsx(le,{sx:{mb:3}}),a.jsx(We,{categories:o,onEdit:h,onDelete:I}),a.jsx(Je,{open:p,onClose:C,onSave:k,initialData:x?{name:x.name,type:x.type,subcategories:x.subcategories||[]}:void 0}),a.jsx(_e,{open:m,hasTransactions:y,onConfirm:T,onCancel:D})]})}export{Ye as default};
